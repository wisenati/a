<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | Facebook Investment</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css"
    />
    <style>
      :root {
        --primary: #4361ee;
        --primary-dark: #3a56d4;
        --secondary: #4895ef;
        --danger: #f72585;
        --success: #4cc9f0;
        --warning: #f8961e;
        --info: #3a86ff;
        --light: #f8f9fa;
        --dark: #212529;
        --gray: #6c757d;
        --light-gray: #e9ecef;
        --border-radius: 8px;
        --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        background-color: #f5f7fa;
        color: var(--dark);
        min-height: 100vh;
        display: flex;
        overflow-x: hidden;
      }

      /* Scrollbar Styles */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--primary);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
      }

      /* Sidebar Styles */
      .sidebar {
        width: 250px;
        background: white;
        box-shadow: var(--box-shadow);
        height: 100vh;
        position: fixed;
        transition: var(--transition);
        z-index: 100;
        overflow-y: auto;
      }

      .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid var(--light-gray);
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .sidebar-header img {
        width: 40px;
        height: 40px;
        margin-right: 10px;
      }

      .sidebar-header h3 {
        color: var(--primary);
        font-size: 1.3rem;
        margin: 0;
      }

      .sidebar-menu {
        padding: 20px 0;
      }

      .menu-category {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: var(--gray);
        padding: 10px 20px;
        margin-top: 10px;
        letter-spacing: 1px;
      }

      .menu-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: var(--dark);
        text-decoration: none;
        transition: var(--transition);
        border-left: 3px solid transparent;
        position: relative;
      }

      .menu-item:hover {
        background-color: rgba(72, 149, 239, 0.1);
        color: var(--primary);
      }

      .menu-item.active {
        background-color: rgba(72, 149, 239, 0.1);
        color: var(--primary);
        border-left: 3px solid var(--primary);
        font-weight: 500;
      }

      .menu-item i {
        margin-right: 10px;
        font-size: 1.1rem;
        width: 20px;
        text-align: center;
      }

      .menu-badge {
        position: absolute;
        right: 15px;
        background: var(--danger);
        color: white;
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 10px;
        font-weight: 500;
      }

      /* Main Content Styles */
      .main-content {
        flex: 1;
        margin-left: 250px;
        transition: var(--transition);
        width: calc(100% - 250px);
      }

      .top-nav {
        background: white;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: var(--box-shadow);
        position: sticky;
        top: 0;
        z-index: 90;
      }

      .nav-left {
        display: flex;
        align-items: center;
      }

      .search-bar {
        position: relative;
        width: 300px;
      }

      .search-bar input {
        width: 100%;
        padding: 10px 15px 10px 40px;
        border: 1px solid var(--light-gray);
        border-radius: var(--border-radius);
        outline: none;
        transition: var(--transition);
      }

      .search-bar input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      }

      .search-bar i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
      }

      .nav-right {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .notification-bell {
        position: relative;
        cursor: pointer;
        font-size: 1.2rem;
        color: var(--gray);
      }

      .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--danger);
        color: white;
        font-size: 0.7rem;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .user-info {
        display: flex;
        align-items: center;
        cursor: pointer;
        position: relative;
      }

      .user-info img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
        object-fit: cover;
        border: 2px solid var(--light-gray);
      }

      .user-name {
        font-weight: 500;
      }

      .user-role {
        font-size: 0.8rem;
        color: var(--gray);
      }

      .user-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        width: 200px;
        z-index: 100;
        display: none;
        margin-top: 10px;
      }

      .user-dropdown.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      .dropdown-item {
        padding: 12px 15px;
        display: flex;
        align-items: center;
        color: var(--dark);
        text-decoration: none;
        transition: var(--transition);
      }

      .dropdown-item:hover {
        background-color: var(--light);
      }

      .dropdown-item i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
      }

      .dropdown-divider {
        height: 1px;
        background: var(--light-gray);
        margin: 5px 0;
      }

      .logout-item {
        color: var(--danger);
      }

      .content-area {
        padding: 25px;
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
      }

      .page-title {
        font-size: 1.8rem;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .page-title i {
        color: var(--primary);
      }

      .header-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: var(--border-radius);
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn i {
        font-size: 1rem;
      }

      .btn-sm {
        padding: 6px 12px;
        font-size: 0.85rem;
      }

      .btn-lg {
        padding: 12px 24px;
        font-size: 1.1rem;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
      }

      .btn-outline-primary {
        background: transparent;
        color: var(--primary);
        border: 1px solid var(--primary);
      }

      .btn-outline-primary:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-2px);
      }

      .btn-danger {
        background: var(--danger);
        color: white;
      }

      .btn-danger:hover {
        background: #e3176a;
        transform: translateY(-2px);
      }

      .btn-success {
        background: var(--success);
        color: white;
      }

      .btn-success:hover {
        background: #3ab0d8;
        transform: translateY(-2px);
      }

      .btn-warning {
        background: var(--warning);
        color: white;
      }

      .btn-warning:hover {
        background: #e68a19;
        transform: translateY(-2px);
      }

      .btn-info {
        background: var(--info);
        color: white;
      }

      .btn-info:hover {
        background: #2a75e8;
        transform: translateY(-2px);
      }

      .btn-light {
        background: var(--light);
        color: var(--dark);
      }

      .btn-light:hover {
        background: #e9ecef;
        transform: translateY(-2px);
      }

      /* Card Styles */
      .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: var(--box-shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
      }

      .stat-icon {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 2.5rem;
        opacity: 0.1;
        color: var(--primary);
      }

      .stat-title {
        font-size: 0.9rem;
        color: var(--gray);
        margin-bottom: 10px;
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 5px;
      }

      .stat-change {
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .stat-change.up {
        color: var(--success);
      }

      .stat-change.down {
        color: var(--danger);
      }

      /* Chart Styles */
      .chart-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .chart-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: var(--box-shadow);
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .chart-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--dark);
      }

      .chart-actions {
        display: flex;
        gap: 10px;
      }

      .chart-canvas {
        width: 100%;
        height: 300px;
      }

      /* Table Styles */
      .table-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
        margin-bottom: 30px;
      }

      .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid var(--light-gray);
      }

      .table-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--dark);
      }

      .table-actions {
        display: flex;
        gap: 10px;
      }

      .table-responsive {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid var(--light-gray);
      }

      th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: var(--dark);
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
      }

      tr:hover {
        background-color: #f8f9fa;
      }

      .status-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .status-pending {
        background-color: #fff3bf;
        color: #e67700;
      }

      .status-approved {
        background-color: #d3f9d8;
        color: #2b8a3e;
      }

      .status-rejected {
        background-color: #ffd8d8;
        color: #c92a2a;
      }

      .status-completed {
        background-color: #d0ebff;
        color: #1971c2;
      }

      .status-active {
        background-color: #d3f9d8;
        color: #2b8a3e;
      }

      .status-inactive {
        background-color: #e9ecef;
        color: #495057;
      }

      .status-cancelled {
        background-color: #ffd8d8;
        color: #c92a2a;
      }

      .action-btn {
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: var(--transition);
        margin-right: 5px;
        font-size: 0.8rem;
      }

      .action-btn i {
        margin-right: 5px;
      }

      .table-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-top: 1px solid var(--light-gray);
      }

      .table-info {
        font-size: 0.9rem;
        color: var(--gray);
      }

      .pagination {
        display: flex;
        align-items: center;
      }

      .pagination-btn {
        padding: 8px 15px;
        margin: 0 5px;
        border: 1px solid var(--light-gray);
        background: white;
        cursor: pointer;
        border-radius: 4px;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .pagination-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      .pagination-btn:hover:not(.active) {
        background: #f1f3f5;
      }

      .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Modal Styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: var(--transition);
      }

      .modal-overlay.active {
        opacity: 1;
        pointer-events: all;
      }

      .modal {
        background: white;
        border-radius: var(--border-radius);
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transform: translateY(20px);
        transition: var(--transition);
      }

      .modal-overlay.active .modal {
        transform: translateY(0);
      }

      .modal-header {
        padding: 20px;
        border-bottom: 1px solid var(--light-gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        background: white;
        z-index: 10;
      }

      .modal-title {
        font-size: 1.3rem;
        font-weight: 600;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray);
        transition: var(--transition);
      }

      .modal-close:hover {
        color: var(--danger);
      }

      .modal-body {
        padding: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
      }

      .form-control {
        width: 100%;
        padding: 10px 15px;
        border: 1px solid var(--light-gray);
        border-radius: var(--border-radius);
        transition: var(--transition);
        font-size: 1rem;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      }

      .form-control.is-invalid {
        border-color: var(--danger);
      }

      .invalid-feedback {
        color: var(--danger);
        font-size: 0.85rem;
        margin-top: 5px;
      }

      .form-text {
        font-size: 0.85rem;
        color: var(--gray);
        margin-top: 5px;
      }

      .form-check {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .form-check-input {
        margin-right: 10px;
      }

      .modal-footer {
        padding: 20px;
        border-top: 1px solid var(--light-gray);
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        position: sticky;
        bottom: 0;
        background: white;
        z-index: 10;
      }

      /* Alert Styles */
      .alert {
        padding: 15px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .alert-success {
        background-color: #d3f9d8;
        color: #2b8a3e;
        border-left: 4px solid #2b8a3e;
      }

      .alert-danger {
        background-color: #ffd8d8;
        color: #c92a2a;
        border-left: 4px solid #c92a2a;
      }

      .alert-warning {
        background-color: #fff3bf;
        color: #e67700;
        border-left: 4px solid #e67700;
      }

      .alert-info {
        background-color: #d0ebff;
        color: #1971c2;
        border-left: 4px solid #1971c2;
      }

      .alert-icon {
        font-size: 1.2rem;
      }

      .alert-close {
        margin-left: auto;
        background: none;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        color: inherit;
        opacity: 0.7;
      }

      .alert-close:hover {
        opacity: 1;
      }

      /* Toast Notification */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .toast {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        padding: 15px;
        width: 300px;
        display: flex;
        align-items: center;
        gap: 10px;
        animation: slideIn 0.3s ease, fadeOut 0.5s ease 2.5s forwards;
        position: relative;
        overflow: hidden;
      }

      .toast-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        background: var(--primary);
        animation: progress 3s linear forwards;
      }

      .toast-success {
        border-left: 4px solid var(--success);
      }

      .toast-success .toast-icon {
        color: var(--success);
      }

      .toast-error {
        border-left: 4px solid var(--danger);
      }

      .toast-error .toast-icon {
        color: var(--danger);
      }

      .toast-warning {
        border-left: 4px solid var(--warning);
      }

      .toast-warning .toast-icon {
        color: var(--warning);
      }

      .toast-info {
        border-left: 4px solid var(--info);
      }

      .toast-info .toast-icon {
        color: var(--info);
      }

      .toast-icon {
        font-size: 1.5rem;
      }

      .toast-content {
        flex: 1;
      }

      .toast-title {
        font-weight: 600;
        margin-bottom: 5px;
      }

      .toast-message {
        font-size: 0.9rem;
        color: var(--gray);
      }

      .toast-close {
        background: none;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        color: var(--gray);
      }

      /* Loading Spinner */
      .spinner-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid var(--light-gray);
        border-top: 5px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      /* Responsive Styles */
      @media (max-width: 992px) {
        .sidebar {
          transform: translateX(-100%);
          z-index: 1000;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
          width: 100%;
        }

        .menu-toggle {
          display: block;
        }

        .chart-container {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .stats-container {
          grid-template-columns: 1fr 1fr;
        }

        .search-bar {
          width: 200px;
        }

        .user-name,
        .user-role {
          display: none;
        }
      }

      @media (max-width: 576px) {
        .stats-container {
          grid-template-columns: 1fr;
        }

        .top-nav {
          padding: 15px;
        }

        .search-bar {
          display: none;
        }

        .page-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }

        .header-actions {
          width: 100%;
          justify-content: space-between;
        }

        .content-area {
          padding: 15px;
        }

        .modal {
          width: 95%;
        }
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
        }
        to {
          transform: translateX(0);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      @keyframes progress {
        from {
          width: 100%;
        }
        to {
          width: 0%;
        }
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      /* Toggle button for mobile */
      .menu-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--dark);
        cursor: pointer;
        margin-right: 15px;
      }

      @media (max-width: 992px) {
        .menu-toggle {
          display: block;
        }
      }

      /* Dark Mode Styles */
      body.dark-mode {
        background-color: #1a1d21;
        color: #e9ecef;
      }

      body.dark-mode .sidebar,
      body.dark-mode .top-nav,
      body.dark-mode .stat-card,
      body.dark-mode .chart-card,
      body.dark-mode .table-container,
      body.dark-mode .modal,
      body.dark-mode .toast {
        background-color: #242830;
        color: #e9ecef;
      }

      body.dark-mode .sidebar-header,
      body.dark-mode .modal-header,
      body.dark-mode .modal-footer {
        border-color: #343a40;
      }

      body.dark-mode th {
        background-color: #343a40;
        color: #e9ecef;
      }

      body.dark-mode td {
        border-color: #343a40;
      }

      body.dark-mode tr:hover {
        background-color: #2c3038;
      }

      body.dark-mode .form-control {
        background-color: #343a40;
        border-color: #495057;
        color: #e9ecef;
      }

      body.dark-mode .form-control:focus {
        border-color: var(--primary);
      }

      body.dark-mode .stat-value {
        color: #e9ecef;
      }

      body.dark-mode .menu-item {
        color: #e9ecef;
      }

      body.dark-mode .menu-item:hover,
      body.dark-mode .menu-item.active {
        background-color: rgba(72, 149, 239, 0.2);
      }

      /* body.dark-mode .dropdown-item {
          color: #e9ec149,239,0.2);
      } */

      body.dark-mode .dropdown-item {
        color: #e9ecef;
      }

      body.dark-mode .dropdown-item:hover {
        background-color: #343a40;
      }

      body.dark-mode .pagination-btn {
        background-color: #343a40;
        border-color: #495057;
        color: #e9ecef;
      }

      body.dark-mode .pagination-btn.active {
        background-color: var(--primary);
      }

      body.dark-mode .spinner-overlay {
        background: rgba(26, 29, 33, 0.8);
      }
    </style>
  </head>
  <body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Spinner -->
    <div class="spinner-overlay" id="loadingSpinner" style="display: none">
      <div class="spinner"></div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <img src="https://via.placeholder.com/40" alt="Logo" />
        <h3>Admin Dashboard</h3>
      </div>
      <div class="sidebar-menu">
        <div class="menu-category">Main</div>
        <a href="#" class="menu-item active" data-section="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
        <a href="#" class="menu-item" data-section="users">
          <i class="fas fa-users"></i>
          <span>Users</span>
        </a>
        <div class="menu-category">Transactions</div>
        <a href="#" class="menu-item" data-section="deposits">
          <i class="fas fa-money-bill-wave"></i>
          <span>Deposits</span>
          <span class="menu-badge" id="pendingDepositsCount">0</span>
        </a>
        <a href="#" class="menu-item" data-section="withdrawals">
          <i class="fas fa-wallet"></i>
          <span>Withdrawals</span>
          <span class="menu-badge" id="pendingWithdrawalsCount">0</span>
        </a>
        <a href="#" class="menu-item" data-section="investments">
          <i class="fas fa-chart-line"></i>
          <span>Investments</span>
        </a>
        <a href="#" class="menu-item" data-section="referrals">
          <i class="fas fa-user-plus"></i>
          <span>Referrals</span>
        </a>
        <div class="menu-category">System</div>
        <a href="#" class="menu-item" data-section="settings">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </a>
        <a href="#" class="menu-item" data-section="logs">
          <i class="fas fa-history"></i>
          <span>Activity Logs</span>
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Top Navigation -->
      <div class="top-nav">
        <div class="nav-left">
          <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
          </button>
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search..." id="globalSearch" />
          </div>
        </div>
        <div class="nav-right">
          <div class="notification-bell" id="notificationBell">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="notificationCount">3</span>
          </div>
          <div class="user-info" id="userInfoDropdown">
            <img
              src="https://randomuser.me/api/portraits/men/32.jpg"
              alt="Admin"
            />
            <div>
              <div class="user-name">Admin User</div>
              <div class="user-role">Administrator</div>
            </div>
            <i
              class="fas fa-chevron-down"
              style="margin-left: 10px; font-size: 0.8rem"
            ></i>
          </div>
          <div class="user-dropdown" id="userDropdown">
            <a href="#" class="dropdown-item">
              <i class="fas fa-user"></i>
              <span>Profile</span>
            </a>
            <a href="#" class="dropdown-item">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item logout-item" id="logoutBtn">
              <i class="fas fa-sign-out-alt"></i>
              <span>Logout</span>
            </a>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <!-- Dashboard Section -->
        <div class="content-section" id="dashboard-section">
          <div class="page-header">
            <h2 class="page-title">
              <i class="fas fa-tachometer-alt"></i> Dashboard Overview
            </h2>
            <div class="header-actions">
              <button class="btn btn-outline-primary" id="refreshDashboardBtn">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
              <button class="btn btn-primary" id="exportReportBtn">
                <i class="fas fa-download"></i> Export Report
              </button>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="stats-container">
            <div class="stat-card">
              <div class="stat-title">Total Users</div>
              <div class="stat-value" id="totalUsers">0</div>
              <div class="stat-change up">
                <i class="fas fa-arrow-up"></i>
                <span id="userChangePercent">12%</span> from last week
              </div>
              <i class="fas fa-users stat-icon"></i>
            </div>
            <div class="stat-card">
              <div class="stat-title">Active Investments</div>
              <div class="stat-value" id="activeInvestments">0</div>
              <div class="stat-change up">
                <i class="fas fa-arrow-up"></i>
                <span id="investmentChangePercent">8%</span> from last week
              </div>
              <i class="fas fa-chart-line stat-icon"></i>
            </div>
            <div class="stat-card">
              <div class="stat-title">Total Deposits</div>
              <div class="stat-value">₦<span id="totalDeposits">0</span></div>
              <div class="stat-change down">
                <i class="fas fa-arrow-down"></i>
                <span id="depositChangePercent">5%</span> from last week
              </div>
              <i class="fas fa-money-bill-wave stat-icon"></i>
            </div>
            <div class="stat-card">
              <div class="stat-title">Total Withdrawals</div>
              <div class="stat-value">
                ₦<span id="totalWithdrawals">0</span>
              </div>
              <div class="stat-change up">
                <i class="fas fa-arrow-up"></i>
                <span id="withdrawalChangePercent">3%</span> from last week
              </div>
              <i class="fas fa-wallet stat-icon"></i>
            </div>
          </div>

          <!-- Charts -->
          <div class="chart-container">
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">Transaction Overview</div>
                <div class="chart-actions">
                  <select class="form-control" id="transactionChartPeriod">
                    <option value="week">Last 7 Days</option>
                    <option value="month" selected>Last 30 Days</option>
                    <option value="year">Last 12 Months</option>
                  </select>
                </div>
              </div>
              <canvas id="transactionChart" class="chart-canvas"></canvas>
            </div>
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">User Growth</div>
                <div class="chart-actions">
                  <select class="form-control" id="userGrowthChartPeriod">
                    <option value="week">Last 7 Days</option>
                    <option value="month" selected>Last 30 Days</option>
                    <option value="year">Last 12 Months</option>
                  </select>
                </div>
              </div>
              <canvas id="userGrowthChart" class="chart-canvas"></canvas>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="table-container">
            <div class="table-header">
              <div class="table-title">Recent Activity</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="refreshActivityBtn"
                >
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Activity</th>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="recentActivityTable">
                  <!-- Recent activity will be loaded here -->
                  <tr>
                    <td colspan="7" class="text-center">
                      Loading recent activity...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info">
                Showing <span id="activityCount">0</span> recent activities
              </div>
              <button class="btn btn-sm btn-primary" id="viewAllActivitiesBtn">
                View All Activities
              </button>
            </div>
          </div>
        </div>

        <!-- Users Section -->
        <div class="content-section" id="users-section" style="display: none">
          <div class="page-header">
            <h2 class="page-title">
              <i class="fas fa-users"></i> User Management
            </h2>
            <div class="header-actions">
              <button class="btn btn-outline-primary" id="exportUsersBtn">
                <i class="fas fa-file-export"></i> Export
              </button>
              <button class="btn btn-primary" id="addUserBtn">
                <i class="fas fa-plus"></i> Add User
              </button>
            </div>
          </div>

          <!-- User Filters -->
          <div class="table-container" style="margin-bottom: 20px">
            <div class="table-header">
              <div class="table-title">Filters</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="clearUserFiltersBtn"
                >
                  <i class="fas fa-times"></i> Clear Filters
                </button>
              </div>
            </div>
            <div style="padding: 15px">
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 15px;
                "
              >
                <div class="form-group" style="margin-bottom: 0">
                  <label for="userStatusFilter">Status</label>
                  <select id="userStatusFilter" class="form-control">
                    <option value="">All Statuses</option>
                    <option value="active">Active</option>
                    <option value="suspended">Suspended</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="userDateFilter">Join Date</label>
                  <select id="userDateFilter" class="form-control">
                    <option value="">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="userSearchFilter">Search</label>
                  <input
                    type="text"
                    id="userSearchFilter"
                    class="form-control"
                    placeholder="Search by username or phone"
                  />
                </div>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <div class="table-title">Users List</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="refreshUsersBtn"
                >
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Phone</th>
                    <th>Balance</th>
                    <th>Joined</th>
                    <th>Last Login</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="usersTable">
                  <!-- Users will be loaded here -->
                  <tr>
                    <td colspan="8" class="text-center">Loading users...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info">
                Showing <span id="usersShowing">0</span> of
                <span id="totalUsersCount">0</span> users
              </div>
              <div class="pagination">
                <button class="pagination-btn" id="prevUsersPage" disabled>
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div id="usersPagination">
                  <button class="pagination-btn active">1</button>
                </div>
                <button class="pagination-btn" id="nextUsersPage">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Deposits Section -->
        <div
          class="content-section"
          id="deposits-section"
          style="display: none"
        >
          <div class="page-header">
            <h2 class="page-title">
              <i class="fas fa-money-bill-wave"></i> Deposit Requests
            </h2>
            <div class="header-actions">
              <button class="btn btn-outline-primary" id="exportDepositsBtn">
                <i class="fas fa-file-export"></i> Export
              </button>
              <button class="btn btn-primary" id="manualDepositBtn">
                <i class="fas fa-plus"></i> Manual Deposit
              </button>
            </div>
          </div>

          <!-- Deposit Filters -->
          <div class="table-container" style="margin-bottom: 20px">
            <div class="table-header">
              <div class="table-title">Filters</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="clearDepositFiltersBtn"
                >
                  <i class="fas fa-times"></i> Clear Filters
                </button>
              </div>
            </div>
            <div style="padding: 15px">
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 15px;
                "
              >
                <div class="form-group" style="margin-bottom: 0">
                  <label for="depositStatusFilter">Status</label>
                  <select id="depositStatusFilter" class="form-control">
                    <option value="">All Statuses</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="depositDateFilter">Date Range</label>
                  <select id="depositDateFilter" class="form-control">
                    <option value="">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="depositSearchFilter">Search</label>
                  <input
                    type="text"
                    id="depositSearchFilter"
                    class="form-control"
                    placeholder="Search by user or amount"
                  />
                </div>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <div class="table-title">Deposit Requests</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="refreshDepositsBtn"
                >
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Amount</th>
                    <th>Sender Info</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="depositsTable">
                  <!-- Deposits will be loaded here -->
                  <tr>
                    <td colspan="7" class="text-center">Loading deposits...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info">
                Showing <span id="depositsShowing">0</span> of
                <span id="totalDepositsCount">0</span> deposits
              </div>
              <div class="pagination">
                <button class="pagination-btn" id="prevDepositsPage" disabled>
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div id="depositsPagination">
                  <button class="pagination-btn active">1</button>
                </div>
                <button class="pagination-btn" id="nextDepositsPage">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Withdrawals Section -->
        <div
          class="content-section"
          id="withdrawals-section"
          style="display: none"
        >
          <div class="page-header">
            <h2 class="page-title">
              <i class="fas fa-wallet"></i> Withdrawal Requests
            </h2>
            <div class="header-actions">
              <button class="btn btn-outline-primary" id="exportWithdrawalsBtn">
                <i class="fas fa-file-export"></i> Export
              </button>
              <button class="btn btn-primary" id="manualWithdrawalBtn">
                <i class="fas fa-plus"></i> Manual Withdrawal
              </button>
            </div>
          </div>

          <!-- Withdrawal Filters -->
          <div class="table-container" style="margin-bottom: 20px">
            <div class="table-header">
              <div class="table-title">Filters</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="clearWithdrawalFiltersBtn"
                >
                  <i class="fas fa-times"></i> Clear Filters
                </button>
              </div>
            </div>
            <div style="padding: 15px">
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 15px;
                "
              >
                <div class="form-group" style="margin-bottom: 0">
                  <label for="withdrawalStatusFilter">Status</label>
                  <select id="withdrawalStatusFilter" class="form-control">
                    <option value="">All Statuses</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="withdrawalDateFilter">Date Range</label>
                  <select id="withdrawalDateFilter" class="form-control">
                    <option value="">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="withdrawalSearchFilter">Search</label>
                  <input
                    type="text"
                    id="withdrawalSearchFilter"
                    class="form-control"
                    placeholder="Search by user or amount"
                  />
                </div>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <div class="table-title">Withdrawal Requests</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="refreshWithdrawalsBtn"
                >
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Amount</th>
                    <th>Bank Details</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="withdrawalsTable">
                  <!-- Withdrawals will be loaded here -->
                  <tr>
                    <td colspan="7" class="text-center">
                      Loading withdrawals...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info">
                Showing <span id="withdrawalsShowing">0</span> of
                <span id="totalWithdrawalsCount">0</span> withdrawals
              </div>
              <div class="pagination">
                <button
                  class="pagination-btn"
                  id="prevWithdrawalsPage"
                  disabled
                >
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div id="withdrawalsPagination">
                  <button class="pagination-btn active">1</button>
                </div>
                <button class="pagination-btn" id="nextWithdrawalsPage">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Investments Section -->
        <div
          class="content-section"
          id="investments-section"
          style="display: none"
        >
          <div class="page-header">
            <h2 class="page-title">
              <i class="fas fa-chart-line"></i> Investment Management
            </h2>
            <div class="header-actions">
              <button class="btn btn-outline-primary" id="exportInvestmentsBtn">
                <i class="fas fa-file-export"></i> Export
              </button>
              <button class="btn btn-primary" id="manageInvestmentPlansBtn">
                <i class="fas fa-cog"></i> Manage Plans
              </button>
            </div>
          </div>

          <!-- Investment Filters -->
          <div class="table-container" style="margin-bottom: 20px">
            <div class="table-header">
              <div class="table-title">Filters</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="clearInvestmentFiltersBtn"
                >
                  <i class="fas fa-times"></i> Clear Filters
                </button>
              </div>
            </div>
            <div style="padding: 15px">
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 15px;
                "
              >
                <div class="form-group" style="margin-bottom: 0">
                  <label for="investmentStatusFilter">Status</label>
                  <select id="investmentStatusFilter" class="form-control">
                    <option value="">All Statuses</option>
                    <option value="active">Active</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="investmentPlanFilter">Plan</label>
                  <select id="investmentPlanFilter" class="form-control">
                    <option value="">All Plans</option>
                    <!-- Plans will be loaded dynamically -->
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="investmentSearchFilter">Search</label>
                  <input
                    type="text"
                    id="investmentSearchFilter"
                    class="form-control"
                    placeholder="Search by user or amount"
                  />
                </div>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <div class="table-title">Active Investments</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="refreshInvestmentsBtn"
                >
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Plan</th>
                    <th>Amount</th>
                    <th>Daily Income</th>
                    <th>Start Date</th>
                    <th>Days Left</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="investmentsTable">
                  <!-- Investments will be loaded here -->
                  <tr>
                    <td colspan="9" class="text-center">
                      Loading investments...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info">
                Showing <span id="investmentsShowing">0</span> of
                <span id="totalInvestmentsCount">0</span> investments
              </div>
              <div class="pagination">
                <button
                  class="pagination-btn"
                  id="prevInvestmentsPage"
                  disabled
                >
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div id="investmentsPagination">
                  <button class="pagination-btn active">1</button>
                </div>
                <button class="pagination-btn" id="nextInvestmentsPage">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Referrals Section -->
        <div
          class="content-section"
          id="referrals-section"
          style="display: none"
        >
          <div class="page-header">
            <h2 class="page-title">
              <i class="fas fa-user-plus"></i> Referral System
            </h2>
            <div class="header-actions">
              <button class="btn btn-outline-primary" id="exportReferralsBtn">
                <i class="fas fa-file-export"></i> Export
              </button>
              <button class="btn btn-primary" id="manageReferralSettingsBtn">
                <i class="fas fa-cog"></i> Referral Settings
              </button>
            </div>
          </div>

          <!-- Referral Stats -->
          <div class="stats-container">
            <div class="stat-card">
              <div class="stat-title">Total Referrals</div>
              <div class="stat-value" id="totalReferrals">0</div>
              <div class="stat-change up">
                <i class="fas fa-arrow-up"></i>
                <span id="referralChangePercent">15%</span> from last month
              </div>
              <i class="fas fa-user-plus stat-icon"></i>
            </div>
            <div class="stat-card">
              <div class="stat-title">Pending Rewards</div>
              <div class="stat-value" id="pendingReferralRewards">0</div>
              <i class="fas fa-clock stat-icon"></i>
            </div>
            <div class="stat-card">
              <div class="stat-title">Total Rewards Paid</div>
              <div class="stat-value">
                ₦<span id="totalReferralRewards">0</span>
              </div>
              <i class="fas fa-gift stat-icon"></i>
            </div>
            <div class="stat-card">
              <div class="stat-title">Top Referrer</div>
              <div class="stat-value" id="topReferrer">-</div>
              <div class="stat-change">
                <span id="topReferrerCount">0</span> referrals
              </div>
              <i class="fas fa-trophy stat-icon"></i>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <div class="table-title">Referral List</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="refreshReferralsBtn"
                >
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Referrer</th>
                    <th>Referred User</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Reward</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="referralsTable">
                  <!-- Referrals will be loaded here -->
                  <tr>
                    <td colspan="7" class="text-center">
                      Loading referrals...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info">
                Showing <span id="referralsShowing">0</span> of
                <span id="totalReferralsCount">0</span> referrals
              </div>
              <div class="pagination">
                <button class="pagination-btn" id="prevReferralsPage" disabled>
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div id="referralsPagination">
                  <button class="pagination-btn active">1</button>
                </div>
                <button class="pagination-btn" id="nextReferralsPage">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Section -->
        <div
          class="content-section"
          id="settings-section"
          style="display: none"
        >
          <div class="page-header">
            <h2 class="page-title">
              <i class="fas fa-cog"></i> System Settings
            </h2>
            <div class="header-actions">
              <button class="btn btn-primary" id="saveSettingsBtn">
                <i class="fas fa-save"></i> Save Changes
              </button>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <div class="table-title">General Settings</div>
            </div>
            <div style="padding: 20px">
              <form id="settingsForm">
                <div
                  style="
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 20px;
                  "
                >
                  <div class="form-group">
                    <label for="siteName">Site Name</label>
                    <input
                      type="text"
                      id="siteName"
                      class="form-control"
                      value="Facebook Investment"
                    />
                    <div class="form-text">
                      This name will appear in emails and notifications
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="minimumDeposit">Minimum Deposit (₦)</label>
                    <input
                      type="number"
                      id="minimumDeposit"
                      class="form-control"
                      value="5000"
                    />
                    <div class="form-text">
                      Minimum amount users can deposit
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="minimumWithdrawal"
                      >Minimum Withdrawal (₦)</label
                    >
                    <input
                      type="number"
                      id="minimumWithdrawal"
                      class="form-control"
                      value="2000"
                    />
                    <div class="form-text">
                      Minimum amount users can withdraw
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="referralBonus">Referral Bonus (₦)</label>
                    <input
                      type="number"
                      id="referralBonus"
                      class="form-control"
                      value="300"
                    />
                    <div class="form-text">
                      Amount users receive for each referral
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="adminEmail">Admin Email</label>
                    <input
                      type="email"
                      id="adminEmail"
                      class="form-control"
                      value="admin@facebookinvestment.com"
                    />
                    <div class="form-text">Email for system notifications</div>
                  </div>

                  <div class="form-group">
                    <label for="maintenanceMode">Maintenance Mode</label>
                    <select id="maintenanceMode" class="form-control">
                      <option value="off">Off</option>
                      <option value="on">On</option>
                    </select>
                    <div class="form-text">
                      Enable to block user access during maintenance
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="bankDetails">Bank Details for Deposits</label>
                  <textarea id="bankDetails" class="form-control" rows="4">
Account Name: PRECIOUS AHUEKWE
Account Number: 5555969924
Bank Name: Moniepoint MFB</textarea
                  >
                  <div class="form-text">
                    These details will be shown to users when making deposits
                  </div>
                </div>

                <div class="form-group">
                  <label for="notificationMessage">Notification Message</label>
                  <textarea
                    id="notificationMessage"
                    class="form-control"
                    rows="3"
                  >
Welcome to Facebook Investment! Invest today and earn daily returns.</textarea
                  >
                  <div class="form-text">
                    This message will be displayed to users on the dashboard
                  </div>
                </div>
              </form>
            </div>
          </div>

          <div class="table-container" style="margin-top: 20px">
            <div class="table-header">
              <div class="table-title">Investment Plans</div>
              <div class="table-actions">
                <button class="btn btn-sm btn-primary" id="addPlanBtn">
                  <i class="fas fa-plus"></i> Add Plan
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Plan Name</th>
                    <th>Minimum Amount</th>
                    <th>Maximum Amount</th>
                    <th>Daily Return (%)</th>
                    <th>Duration (Days)</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="plansTable">
                  <!-- Plans will be loaded here -->
                  <tr>
                    <td>Basic Plan</td>
                    <td>₦5,000</td>
                    <td>₦50,000</td>
                    <td>1.5%</td>
                    <td>30</td>
                    <td>
                      <span class="status-badge status-active">Active</span>
                    </td>
                    <td>
                      <button class="action-btn btn-primary" data-id="plan1">
                        <i class="fas fa-edit"></i> Edit
                      </button>
                      <button class="action-btn btn-danger" data-id="plan1">
                        <i class="fas fa-trash"></i> Delete
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>Premium Plan</td>
                    <td>₦50,000</td>
                    <td>₦500,000</td>
                    <td>2%</td>
                    <td>45</td>
                    <td>
                      <span class="status-badge status-active">Active</span>
                    </td>
                    <td>
                      <button class="action-btn btn-primary" data-id="plan2">
                        <i class="fas fa-edit"></i> Edit
                      </button>
                      <button class="action-btn btn-danger" data-id="plan2">
                        <i class="fas fa-trash"></i> Delete
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Activity Logs Section -->
        <div class="content-section" id="logs-section" style="display: none">
          <div class="page-header">
            <h2 class="page-title">
              <i class="fas fa-history"></i> Activity Logs
            </h2>
            <div class="header-actions">
              <button class="btn btn-outline-primary" id="exportLogsBtn">
                <i class="fas fa-file-export"></i> Export
              </button>
              <button class="btn btn-danger" id="clearLogsBtn">
                <i class="fas fa-trash"></i> Clear Logs
              </button>
            </div>
          </div>

          <!-- Log Filters -->
          <div class="table-container" style="margin-bottom: 20px">
            <div class="table-header">
              <div class="table-title">Filters</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="clearLogFiltersBtn"
                >
                  <i class="fas fa-times"></i> Clear Filters
                </button>
              </div>
            </div>
            <div style="padding: 15px">
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 15px;
                "
              >
                <div class="form-group" style="margin-bottom: 0">
                  <label for="logTypeFilter">Log Type</label>
                  <select id="logTypeFilter" class="form-control">
                    <option value="">All Types</option>
                    <option value="login">Login</option>
                    <option value="deposit">Deposit</option>
                    <option value="withdrawal">Withdrawal</option>
                    <option value="investment">Investment</option>
                    <option value="user">User Management</option>
                    <option value="system">System</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="logDateFilter">Date Range</label>
                  <select id="logDateFilter" class="form-control">
                    <option value="">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0">
                  <label for="logSearchFilter">Search</label>
                  <input
                    type="text"
                    id="logSearchFilter"
                    class="form-control"
                    placeholder="Search logs"
                  />
                </div>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <div class="table-title">System Logs</div>
              <div class="table-actions">
                <button
                  class="btn btn-sm btn-outline-primary"
                  id="refreshLogsBtn"
                >
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>IP Address</th>
                    <th>Date & Time</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody id="logsTable">
                  <!-- Logs will be loaded here -->
                  <tr>
                    <td colspan="7" class="text-center">Loading logs...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info">
                Showing <span id="logsShowing">0</span> of
                <span id="totalLogsCount">0</span> logs
              </div>
              <div class="pagination">
                <button class="pagination-btn" id="prevLogsPage" disabled>
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div id="logsPagination">
                  <button class="pagination-btn active">1</button>
                </div>
                <button class="pagination-btn" id="nextLogsPage">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal-overlay" id="addUserModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Add New User</h3>
          <button class="modal-close" id="closeAddUserModal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="addUserForm">
            <div class="form-group">
              <label for="newUsername">Username</label>
              <input
                type="text"
                id="newUsername"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="newPhone">Phone Number</label>
              <input type="tel" id="newPhone" class="form-control" required />
            </div>
            <div class="form-group">
              <label for="newPassword">Password</label>
              <input
                type="password"
                id="newPassword"
                class="form-control"
                required
              />
              <div class="form-text">
                Password must be at least 6 characters
              </div>
            </div>
            <div class="form-group">
              <label for="newBalance">Initial Balance (₦)</label>
              <input
                type="number"
                id="newBalance"
                class="form-control"
                value="0"
              />
            </div>
            <div class="form-group">
              <label for="userRole">Role</label>
              <select id="userRole" class="form-control">
                <option value="user">User</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <div class="form-group">
              <div class="form-check">
                <input
                  type="checkbox"
                  id="sendWelcomeMessage"
                  class="form-check-input"
                  checked
                />
                <label for="sendWelcomeMessage"
                  >Send welcome message to user</label
                >
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" id="cancelAddUser">Cancel</button>
          <button class="btn btn-primary" id="confirmAddUser">Add User</button>
        </div>
      </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal-overlay" id="editUserModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Edit User</h3>
          <button class="modal-close" id="closeEditUserModal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="editUserForm">
            <input type="hidden" id="editUserId" />
            <div class="form-group">
              <label for="editUsername">Username</label>
              <input
                type="text"
                id="editUsername"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="editPhone">Phone Number</label>
              <input type="tel" id="editPhone" class="form-control" required />
            </div>
            <div class="form-group">
              <label for="editPassword"
                >Password (leave blank to keep current)</label
              >
              <input type="password" id="editPassword" class="form-control" />
            </div>
            <div class="form-group">
              <label for="editBalance">Balance (₦)</label>
              <input
                type="number"
                id="editBalance"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="editStatus">Status</label>
              <select id="editStatus" class="form-control">
                <option value="active">Active</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
            <div class="form-group">
              <label for="editRole">Role</label>
              <select id="editRole" class="form-control">
                <option value="user">User</option>
                <option value="admin">Admin</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" id="cancelEditUser">Cancel</button>
          <button class="btn btn-primary" id="confirmEditUser">
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <!-- Deposit Action Modal -->
    <div class="modal-overlay" id="depositActionModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Process Deposit</h3>
          <button class="modal-close" id="closeDepositActionModal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div id="depositDetails" class="alert alert-info">
            <!-- Deposit details will be loaded here -->
          </div>
          <div class="form-group">
            <label for="depositAction">Action</label>
            <select id="depositAction" class="form-control">
              <option value="approve">Approve</option>
              <option value="reject">Reject</option>
            </select>
          </div>
          <div class="form-group" id="rejectReasonGroup" style="display: none">
            <label for="rejectReason">Reason for Rejection</label>
            <textarea
              id="rejectReason"
              class="form-control"
              rows="3"
            ></textarea>
          </div>
          <div class="form-group" id="notifyUserGroup">
            <div class="form-check">
              <input
                type="checkbox"
                id="notifyUser"
                class="form-check-input"
                checked
              />
              <label for="notifyUser">Notify user about this action</label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" id="cancelDepositAction">Cancel</button>
          <button class="btn btn-primary" id="confirmDepositAction">
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Withdrawal Action Modal -->
    <div class="modal-overlay" id="withdrawalActionModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Process Withdrawal</h3>
          <button class="modal-close" id="closeWithdrawalActionModal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div id="withdrawalDetails" class="alert alert-info">
            <!-- Withdrawal details will be loaded here -->
          </div>
          <div class="form-group">
            <label for="withdrawalAction">Action</label>
            <select id="withdrawalAction" class="form-control">
              <option value="approve">Approve</option>
              <option value="reject">Reject</option>
            </select>
          </div>
          <div
            class="form-group"
            id="withdrawalRejectReasonGroup"
            style="display: none"
          >
            <label for="withdrawalRejectReason">Reason for Rejection</label>
            <textarea
              id="withdrawalRejectReason"
              class="form-control"
              rows="3"
            ></textarea>
          </div>
          <div class="form-group">
            <div class="form-check">
              <input
                type="checkbox"
                id="notifyWithdrawalUser"
                class="form-check-input"
                checked
              />
              <label for="notifyWithdrawalUser"
                >Notify user about this action</label
              >
            </div>
          </div>
          <div class="form-group" id="transactionProofGroup">
            <label for="transactionProof">Transaction Proof (Optional)</label>
            <input type="file" id="transactionProof" class="form-control" />
            <div class="form-text">Upload a screenshot of the transaction</div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" id="cancelWithdrawalAction">
            Cancel
          </button>
          <button class="btn btn-primary" id="confirmWithdrawalAction">
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Manual Deposit Modal -->
    <div class="modal-overlay" id="manualDepositModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Add Manual Deposit</h3>
          <button class="modal-close" id="closeManualDepositModal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="manualDepositForm">
            <div class="form-group">
              <label for="depositUser">Select User</label>
              <select id="depositUser" class="form-control" required>
                <option value="">Select a user</option>
                <!-- Users will be loaded dynamically -->
              </select>
            </div>
            <div class="form-group">
              <label for="depositAmount">Amount (₦)</label>
              <input
                type="number"
                id="depositAmount"
                class="form-control"
                required
                min="1"
              />
            </div>
            <div class="form-group">
              <label for="depositNote">Note</label>
              <textarea
                id="depositNote"
                class="form-control"
                rows="3"
                placeholder="Reason for manual deposit"
              ></textarea>
            </div>
            <div class="form-group">
              <div class="form-check">
                <input
                  type="checkbox"
                  id="notifyDepositUser"
                  class="form-check-input"
                  checked
                />
                <label for="notifyDepositUser"
                  >Notify user about this deposit</label
                >
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" id="cancelManualDeposit">Cancel</button>
          <button class="btn btn-primary" id="confirmManualDeposit">
            Add Deposit
          </button>
        </div>
      </div>
    </div>

    <!-- Investment Plan Modal -->
    <div class="modal-overlay" id="investmentPlanModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title" id="planModalTitle">Add Investment Plan</h3>
          <button class="modal-close" id="closeInvestmentPlanModal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="investmentPlanForm">
            <input type="hidden" id="planId" />
            <div class="form-group">
              <label for="planName">Plan Name</label>
              <input type="text" id="planName" class="form-control" required />
            </div>
            <div class="form-group">
              <label for="planMinAmount">Minimum Amount (₦)</label>
              <input
                type="number"
                id="planMinAmount"
                class="form-control"
                required
                min="1"
              />
            </div>
            <div class="form-group">
              <label for="planMaxAmount">Maximum Amount (₦)</label>
              <input
                type="number"
                id="planMaxAmount"
                class="form-control"
                required
                min="1"
              />
            </div>
            <div class="form-group">
              <label for="planDailyReturn">Daily Return (%)</label>
              <input
                type="number"
                id="planDailyReturn"
                class="form-control"
                required
                step="0.1"
                min="0.1"
              />
            </div>
            <div class="form-group">
              <label for="planDuration">Duration (Days)</label>
              <input
                type="number"
                id="planDuration"
                class="form-control"
                required
                min="1"
              />
            </div>
            <div class="form-group">
              <label for="planStatus">Status</label>
              <select id="planStatus" class="form-control">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
            <div class="form-group">
              <label for="planDescription">Description</label>
              <textarea
                id="planDescription"
                class="form-control"
                rows="3"
              ></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" id="cancelInvestmentPlan">
            Cancel
          </button>
          <button class="btn btn-primary" id="confirmInvestmentPlan">
            Save Plan
          </button>
        </div>
      </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

    <!-- Main Script -->
    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCgOvIkDCcS3DFrt5f6Y7pYmjCoHIfDF9U",
        authDomain: "moniebase-b4b4d.firebaseapp.com",
        projectId: "moniebase-b4b4d",
        storageBucket: "moniebase-b4b4d.appspot.com",
        messagingSenderId: "1009678808253",
        appId: "1:1009678808253:android:ff94e94c52bad2db7973d4",
        databaseURL: "https://moniebase-b4b4d-default-rtdb.firebaseio.com/",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
      const auth = firebase.auth();
      const storage = firebase.storage();
      const mapKey = "danreg";

      // Global variables
      let currentUser = null;
      let users = [];
      let deposits = [];
      let withdrawals = [];
      let investments = [];
      let referrals = [];
      let plans = [];
      let logs = [];

      // Pagination variables
      const itemsPerPage = 10;
      let currentPage = {
        users: 1,
        deposits: 1,
        withdrawals: 1,
        investments: 1,
        referrals: 1,
        logs: 1,
      };

      // DOM Elements
      const sidebar = document.getElementById("sidebar");
      const menuToggle = document.getElementById("menuToggle");
      const logoutBtn = document.getElementById("logoutBtn");
      const menuItems = document.querySelectorAll(".menu-item");
      const contentSections = document.querySelectorAll(".content-section");
      const userInfoDropdown = document.getElementById("userInfoDropdown");
      const userDropdown = document.getElementById("userDropdown");
      const loadingSpinner = document.getElementById("loadingSpinner");
      const toastContainer = document.getElementById("toastContainer");

      // Charts
      let transactionChart = null;
      let userGrowthChart = null;

      // Show loading spinner
      function showLoading() {
        loadingSpinner.style.display = "flex";
      }

      // Hide loading spinner
      function hideLoading() {
        loadingSpinner.style.display = "none";
      }

      // Show toast notification
      function showToast(type, title, message) {
        const toast = document.createElement("div");
        toast.className = `toast toast-${type}`;

        toast.innerHTML = `
                  <div class="toast-icon">
                      <i class="fas fa-${
                        type === "success"
                          ? "check-circle"
                          : type === "error"
                          ? "exclamation-circle"
                          : type === "warning"
                          ? "exclamation-triangle"
                          : "info-circle"
                      }"></i>
                  </div>
                  <div class="toast-content">
                      <div class="toast-title">${title}</div>
                      <div class="toast-message">${message}</div>
                  </div>
                  <button class="toast-close">&times;</button>
                  <div class="toast-progress" style="width: 100%"></div>
              `;

        toastContainer.appendChild(toast);

        // Add event listener to close button
        toast.querySelector(".toast-close").addEventListener("click", () => {
          toast.remove();
        });

        // Auto remove after 3 seconds
        setTimeout(() => {
          toast.remove();
        }, 3000);
      }

      // Format currency
      function formatCurrency(amount) {
        return parseFloat(amount).toLocaleString();
      }

      // Format date
      function formatDate(timestamp) {
        return new Date(timestamp).toLocaleDateString();
      }

      // Format date and time
      function formatDateTime(timestamp) {
        return new Date(timestamp).toLocaleString();
      }

      // Get status class for badges
      function getStatusClass(status) {
        switch (status.toLowerCase()) {
          case "pending":
            return "status-pending";
          case "approved":
            return "status-approved";
          case "rejected":
            return "status-rejected";
          case "completed":
            return "status-completed";
          case "active":
            return "status-active";
          case "inactive":
            return "status-inactive";
          case "cancelled":
            return "status-cancelled";
          default:
            return "";
        }
      }

      // Toggle sidebar on mobile
      menuToggle.addEventListener("click", () => {
        sidebar.classList.toggle("active");
      });

      // Toggle user dropdown
      userInfoDropdown.addEventListener("click", () => {
        userDropdown.classList.toggle("active");
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (
          !userInfoDropdown.contains(e.target) &&
          !userDropdown.contains(e.target)
        ) {
          userDropdown.classList.remove("active");
        }
      });

      // Logout function
      logoutBtn.addEventListener("click", (e) => {
        e.preventDefault();

        // Show confirmation dialog
        if (confirm("Are you sure you want to logout?")) {
          // Clear admin session and redirect to login
          sessionStorage.removeItem("adminUser");
          window.location.href = "admin-login.html";
        }
      });

      // Switch between sections
      menuItems.forEach((item) => {
        item.addEventListener("click", (e) => {
          e.preventDefault();

          // Remove active class from all menu items
          menuItems.forEach((i) => i.classList.remove("active"));

          // Add active class to clicked item
          item.classList.add("active");

          // Hide all content sections
          contentSections.forEach((section) => {
            section.style.display = "none";
          });

          // Show the selected section
          const sectionId = item.getAttribute("data-section") + "-section";
          document.getElementById(sectionId).style.display = "block";

          // Load data for the section
          loadSectionData(item.getAttribute("data-section"));

          // Close sidebar on mobile
          if (window.innerWidth < 992) {
            sidebar.classList.remove("active");
          }
        });
      });

      // Load data for the current section
      function loadSectionData(section) {
        showLoading();

        switch (section) {
          case "dashboard":
            loadDashboardData();
            break;
          case "users":
            loadUsersData();
            break;
          case "deposits":
            loadDepositsData();
            break;
          case "withdrawals":
            loadWithdrawalsData();
            break;
          case "investments":
            loadInvestmentsData();
            break;
          case "referrals":
            loadReferralsData();
            break;
          case "settings":
            loadSettingsData();
            break;
          case "logs":
            loadLogsData();
            break;
        }
      }

      // Load dashboard data
      function loadDashboardData() {
        Promise.all([
          // Load total users
          database.ref(`investment/${mapKey}`).once("value"),

          // Load active investments
          database.ref(`investments/${mapKey}`).once("value"),

          // Load total deposits
          database.ref("payments").once("value"),

          // Load total withdrawals
          database.ref(`withdrawals/${mapKey}`).once("value"),
        ])
          .then(
            ([
              usersSnapshot,
              investmentsSnapshot,
              depositsSnapshot,
              withdrawalsSnapshot,
            ]) => {
              // Process users data
              const totalUsers = usersSnapshot.numChildren();
              document.getElementById("totalUsers").textContent = totalUsers;

              // Process investments data
              let activeCount = 0;
              investmentsSnapshot.forEach((userSnapshot) => {
                userSnapshot.forEach((investmentSnapshot) => {
                  const investment = investmentSnapshot.val();
                  if (investment.status === "active") {
                    activeCount++;
                  }
                });
              });
              document.getElementById("activeInvestments").textContent =
                activeCount;

              // Process deposits data
              let totalDeposits = 0;
              depositsSnapshot.forEach((paymentSnapshot) => {
                const payment = paymentSnapshot.val();
                if (payment.status === "approved") {
                  totalDeposits += parseFloat(payment.amount);
                }
              });
              document.getElementById("totalDeposits").textContent =
                formatCurrency(totalDeposits);

              // Process withdrawals data
              let totalWithdrawals = 0;
              withdrawalsSnapshot.forEach((userSnapshot) => {
                userSnapshot.forEach((withdrawalSnapshot) => {
                  const withdrawal = withdrawalSnapshot.val();
                  if (withdrawal.status === "approved") {
                    totalWithdrawals += parseFloat(withdrawal.amount);
                  }
                });
              });
              document.getElementById("totalWithdrawals").textContent =
                formatCurrency(totalWithdrawals);

              // Load recent activity
              loadRecentActivity();

              // Initialize charts
              initializeCharts();

              hideLoading();
            }
          )
          .catch((error) => {
            console.error("Error loading dashboard data:", error);
            showToast("error", "Error", "Failed to load dashboard data");
            hideLoading();
          });
      }

      // Initialize charts
      function initializeCharts() {
        // Transaction chart
        const transactionCtx = document
          .getElementById("transactionChart")
          .getContext("2d");

        // Sample data - in a real app, this would come from your database
        const transactionData = {
          labels: [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ],
          datasets: [
            {
              label: "Deposits",
              data: [
                12000, 19000, 15000, 25000, 22000, 30000, 35000, 40000, 38000,
                42000, 45000, 50000,
              ],
              backgroundColor: "rgba(72, 149, 239, 0.2)",
              borderColor: "rgba(72, 149, 239, 1)",
              borderWidth: 2,
              tension: 0.4,
            },
            {
              label: "Withdrawals",
              data: [
                8000, 12000, 10000, 15000, 18000, 20000, 25000, 28000, 30000,
                32000, 35000, 38000,
              ],
              backgroundColor: "rgba(247, 37, 133, 0.2)",
              borderColor: "rgba(247, 37, 133, 1)",
              borderWidth: 2,
              tension: 0.4,
            },
          ],
        };

        if (transactionChart) {
          transactionChart.destroy();
        }

        transactionChart = new Chart(transactionCtx, {
          type: "line",
          data: transactionData,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "top",
              },
              tooltip: {
                mode: "index",
                intersect: false,
                callbacks: {
                  label: function (context) {
                    let label = context.dataset.label || "";
                    if (label) {
                      label += ": ";
                    }
                    if (context.parsed.y !== null) {
                      label += "₦" + context.parsed.y.toLocaleString();
                    }
                    return label;
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return "₦" + value.toLocaleString();
                  },
                },
              },
            },
          },
        });

        // User growth chart
        const userGrowthCtx = document
          .getElementById("userGrowthChart")
          .getContext("2d");

        // Sample data - in a real app, this would come from your database
        const userGrowthData = {
          labels: [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ],
          datasets: [
            {
              label: "New Users",
              data: [20, 35, 45, 30, 50, 70, 80, 90, 100, 120, 130, 150],
              backgroundColor: "rgba(76, 201, 240, 0.2)",
              borderColor: "rgba(76, 201, 240, 1)",
              borderWidth: 2,
              tension: 0.4,
            },
            {
              label: "Active Users",
              data: [15, 30, 40, 25, 45, 60, 70, 85, 95, 110, 120, 140],
              backgroundColor: "rgba(58, 134, 255, 0.2)",
              borderColor: "rgba(58, 134, 255, 1)",
              borderWidth: 2,
              tension: 0.4,
            },
          ],
        };

        if (userGrowthChart) {
          userGrowthChart.destroy();
        }

        userGrowthChart = new Chart(userGrowthCtx, {
          type: "line",
          data: userGrowthData,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "top",
              },
              tooltip: {
                mode: "index",
                intersect: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });

        // Add event listeners to chart period selectors
        document
          .getElementById("transactionChartPeriod")
          .addEventListener("change", updateTransactionChart);
        document
          .getElementById("userGrowthChartPeriod")
          .addEventListener("change", updateUserGrowthChart);
      }

      // Update transaction chart based on selected period
      function updateTransactionChart() {
        const period = document.getElementById("transactionChartPeriod").value;

        // In a real app, you would fetch data for the selected period from your database
        // For this example, we'll just show a toast notification
        showToast(
          "info",
          "Chart Updated",
          `Transaction chart updated to show data for the last ${
            period === "week"
              ? "7 days"
              : period === "month"
              ? "30 days"
              : "12 months"
          }`
        );
      }

      // Update user growth chart based on selected period
      function updateUserGrowthChart() {
        const period = document.getElementById("userGrowthChartPeriod").value;

        // In a real app, you would fetch data for the selected period from your database
        // For this example, we'll just show a toast notification
        showToast(
          "info",
          "Chart Updated",
          `User growth chart updated to show data for the last ${
            period === "week"
              ? "7 days"
              : period === "month"
              ? "30 days"
              : "12 months"
          }`
        );
      }

      // Load recent activity
      function loadRecentActivity() {
        const table = document.getElementById("recentActivityTable");
        table.innerHTML = "";

        // This would ideally combine data from multiple sources (deposits, withdrawals, investments)
        // For simplicity, we'll just show recent deposits

        database
          .ref("payments")
          .orderByChild("timestamp")
          .limitToLast(5)
          .once("value")
          .then((snapshot) => {
            let count = 0;

            snapshot.forEach((paymentSnapshot) => {
              count++;
              const payment = paymentSnapshot.val();
              const row = document.createElement("tr");

              row.innerHTML = `
                              <td>${paymentSnapshot.key.substring(0, 6)}</td>
                              <td>${payment.senderName || "Unknown"}</td>
                              <td>Deposit</td>
                              <td>₦${formatCurrency(payment.amount)}</td>
                              <td>${formatDateTime(payment.timestamp)}</td>
                              <td><span class="status-badge ${getStatusClass(
                                payment.status
                              )}">${payment.status}</span></td>
                              <td>
                                  <button class="action-btn btn-primary" data-id="${
                                    paymentSnapshot.key
                                  }" data-type="deposit">
                                      <i class="fas fa-eye"></i> View
                                  </button>
                              </td>
                          `;

              table.appendChild(row);
            });

            // Update activity count
            document.getElementById("activityCount").textContent = count;

            // Add event listeners to view buttons
            document
              .querySelectorAll('[data-type="deposit"]')
              .forEach((btn) => {
                btn.addEventListener("click", () =>
                  viewDeposit(btn.getAttribute("data-id"))
                );
              });

            // If no activities found
            if (count === 0) {
              table.innerHTML = `
                              <tr>
                                  <td colspan="7" class="text-center">No recent activities found</td>
                              </tr>
                          `;
            }
          })
          .catch((error) => {
            console.error("Error loading recent activity:", error);
            table.innerHTML = `
                          <tr>
                              <td colspan="7" class="text-center">Error loading recent activities</td>
                          </tr>
                      `;
          });
      }

      // View deposit details
      function viewDeposit(depositId) {
        showLoading();

        database
          .ref(`payments/${depositId}`)
          .once("value")
          .then((snapshot) => {
            const deposit = snapshot.val();
            if (deposit) {
              // Store current deposit ID for processing
              currentProcessingDepositId = depositId;

              // Display deposit details
              const detailsDiv = document.getElementById("depositDetails");
              detailsDiv.innerHTML = `
                              <div class="alert-icon"><i class="fas fa-info-circle"></i></div>
                              <div>
                                  <p><strong>User:</strong> ${
                                    deposit.senderName || "Unknown"
                                  }</p>
                                  <p><strong>Amount:</strong> ₦${formatCurrency(
                                    deposit.amount
                                  )}</p>
                                  <p><strong>Account Number:</strong> ${
                                    deposit.senderAccount || "N/A"
                                  }</p>
                                  <p><strong>Date:</strong> ${formatDateTime(
                                    deposit.timestamp
                                  )}</p>
                                  <p><strong>Current Status:</strong> <span class="status-badge ${getStatusClass(
                                    deposit.status
                                  )}">${deposit.status}</span></p>
                              </div>
                          `;

              // Show modal
              document
                .getElementById("depositActionModal")
                .classList.add("active");
            } else {
              showToast("error", "Error", "Deposit not found");
            }

            hideLoading();
          })
          .catch((error) => {
            console.error("Error viewing deposit:", error);
            showToast("error", "Error", "Failed to load deposit details");
            hideLoading();
          });
      }

      // Load users data
      function loadUsersData() {
        const table = document.getElementById("usersTable");
        table.innerHTML =
          '<tr><td colspan="8" class="text-center">Loading users...</td></tr>';
        users = [];

        database
          .ref(`investment/${mapKey}`)
          .once("value")
          .then((snapshot) => {
            users = [];

            snapshot.forEach((userSnapshot) => {
              const user = userSnapshot.val();
              user.key = userSnapshot.key;
              users.push(user);
            });

            // Update total users count
            document.getElementById("totalUsersCount").textContent =
              users.length;

            // Apply pagination
            renderUsersTable();

            hideLoading();
          })
          .catch((error) => {
            console.error("Error loading users:", error);
            table.innerHTML = `
                          <tr>
                              <td colspan="8" class="text-center">Error loading users</td>
                          </tr>
                      `;
            showToast("error", "Error", "Failed to load users data");
            hideLoading();
          });
      }

      // Render users table with pagination
      function renderUsersTable() {
        const table = document.getElementById("usersTable");
        table.innerHTML = "";

        // Apply filters
        const statusFilter = document.getElementById("userStatusFilter").value;
        const dateFilter = document.getElementById("userDateFilter").value;
        const searchFilter = document
          .getElementById("userSearchFilter")
          .value.toLowerCase();

        let filteredUsers = users.filter((user) => {
          // Status filter
          if (statusFilter && user.status !== statusFilter) {
            return false;
          }

          // Date filter
          if (dateFilter) {
            const now = new Date();
            const userDate = new Date(user.createdAt);

            if (dateFilter === "today") {
              if (userDate.toDateString() !== now.toDateString()) {
                return false;
              }
            } else if (dateFilter === "week") {
              const weekAgo = new Date();
              weekAgo.setDate(now.getDate() - 7);
              if (userDate < weekAgo) {
                return false;
              }
            } else if (dateFilter === "month") {
              const monthAgo = new Date();
              monthAgo.setMonth(now.getMonth() - 1);
              if (userDate < monthAgo) {
                return false;
              }
            }
          }

          // Search filter
          if (searchFilter) {
            const username = (user.username || "").toLowerCase();
            const phone = (user.phoneNumber || "").toLowerCase();

            if (
              !username.includes(searchFilter) &&
              !phone.includes(searchFilter)
            ) {
              return false;
            }
          }

          return true;
        });

        // Sort users by creation date (newest first)
        filteredUsers.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

        // Calculate pagination
        const totalPages = Math.ceil(filteredUsers.length / itemsPerPage);
        const startIndex = (currentPage.users - 1) * itemsPerPage;
        const endIndex = Math.min(
          startIndex + itemsPerPage,
          filteredUsers.length
        );
        const paginatedUsers = filteredUsers.slice(startIndex, endIndex);

        // Update pagination info
        document.getElementById("usersShowing").textContent =
          paginatedUsers.length;
        document.getElementById("totalUsersCount").textContent =
          filteredUsers.length;

        // Enable/disable pagination buttons
        document.getElementById("prevUsersPage").disabled =
          currentPage.users === 1;
        document.getElementById("nextUsersPage").disabled =
          currentPage.users >= totalPages;

        // Render pagination numbers
        const paginationContainer = document.getElementById("usersPagination");
        paginationContainer.innerHTML = "";

        for (let i = 1; i <= totalPages; i++) {
          const pageBtn = document.createElement("button");
          pageBtn.className = `pagination-btn ${
            i === currentPage.users ? "active" : ""
          }`;
          pageBtn.textContent = i;
          pageBtn.addEventListener("click", () => {
            currentPage.users = i;
            renderUsersTable();
          });
          paginationContainer.appendChild(pageBtn);
        }

        // If no users found
        if (paginatedUsers.length === 0) {
          table.innerHTML = `
                      <tr>
                          <td colspan="8" class="text-center">No users found</td>
                      </tr>
                  `;
          return;
        }

        // Render users
        paginatedUsers.forEach((user) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                      <td>${user.key.substring(0, 6)}</td>
                      <td>${user.username || "N/A"}</td>
                      <td>${user.phoneNumber || "N/A"}</td>
                      <td>₦${formatCurrency(user.balance || 0)}</td>
                      <td>${
                        user.createdAt ? formatDate(user.createdAt) : "N/A"
                      }</td>
                      <td>${
                        user.lastLogin
                          ? formatDateTime(user.lastLogin)
                          : "Never"
                      }</td>
                      <td><span class="status-badge ${getStatusClass(
                        user.status || "active"
                      )}">${user.status || "active"}</span></td>
                      <td>
                          <button class="action-btn btn-primary edit-user-btn" data-id="${
                            user.key
                          }">
                              <i class="fas fa-edit"></i> Edit
                          </button>
                          <button class="action-btn btn-danger delete-user-btn" data-id="${
                            user.key
                          }">
                              <i class="fas fa-trash"></i> Delete
                          </button>
                      </td>
                  `;

          table.appendChild(row);
        });

        // Add event listeners to action buttons
        document.querySelectorAll(".edit-user-btn").forEach((btn) => {
          btn.addEventListener("click", () =>
            openEditUserModal(btn.getAttribute("data-id"))
          );
        });

        document.querySelectorAll(".delete-user-btn").forEach((btn) => {
          btn.addEventListener("click", () =>
            deleteUser(btn.getAttribute("data-id"))
          );
        });
      }

      // Open add user modal
      document.getElementById("addUserBtn").addEventListener("click", () => {
        document.getElementById("addUserForm").reset();
        document.getElementById("addUserModal").classList.add("active");
      });

      // Close add user modal
      document
        .getElementById("closeAddUserModal")
        .addEventListener("click", () => {
          document.getElementById("addUserModal").classList.remove("active");
        });

      document.getElementById("cancelAddUser").addEventListener("click", () => {
        document.getElementById("addUserModal").classList.remove("active");
      });

      // Confirm add user
      document
        .getElementById("confirmAddUser")
        .addEventListener("click", () => {
          const username = document.getElementById("newUsername").value.trim();
          const phone = document.getElementById("newPhone").value.trim();
          const password = document.getElementById("newPassword").value.trim();
          const balance =
            parseFloat(document.getElementById("newBalance").value) || 0;
          const role = document.getElementById("userRole").value;
          const sendWelcome =
            document.getElementById("sendWelcomeMessage").checked;

          // Validate inputs
          if (!username) {
            showToast("error", "Validation Error", "Username is required");
            return;
          }

          if (!phone) {
            showToast("error", "Validation Error", "Phone number is required");
            return;
          }

          if (!password || password.length < 6) {
            showToast(
              "error",
              "Validation Error",
              "Password must be at least 6 characters"
            );
            return;
          }

          showLoading();

          // Check if phone number already exists
          database
            .ref(`investment/${mapKey}`)
            .orderByChild("phoneNumber")
            .equalTo(phone)
            .once("value")
            .then((snapshot) => {
              if (snapshot.exists()) {
                showToast(
                  "error",
                  "Validation Error",
                  "Phone number already exists"
                );
                hideLoading();
                return Promise.reject("Phone number already exists");
              }

              // Create new user
              const newUserRef = database.ref(`investment/${mapKey}`).push();
              return newUserRef.set({
                username: username,
                phoneNumber: phone,
                password: password,
                balance: balance,
                status: "active",
                role: role,
                createdAt: new Date().getTime(),
                createdBy: "admin",
              });
            })
            .then(() => {
              // Log the action
              logAction("user", "create", `Created new user: ${username}`);

              showToast("success", "Success", "User added successfully");
              document
                .getElementById("addUserModal")
                .classList.remove("active");
              document.getElementById("addUserForm").reset();
              loadUsersData();

              // Send welcome message (in a real app)
              if (sendWelcome) {
                // This would send a welcome message to the user
                showToast(
                  "info",
                  "Notification",
                  `Welcome message sent to ${username}`
                );
              }
            })
            .catch((error) => {
              if (error !== "Phone number already exists") {
                console.error("Error adding user:", error);
                showToast("error", "Error", "Failed to add user");
              }
              hideLoading();
            });
        });

      // Open edit user modal
      function openEditUserModal(userId) {
        showLoading();

        const user = users.find((u) => u.key === userId);
        if (!user) {
          showToast("error", "Error", "User not found");
          hideLoading();
          return;
        }

        currentEditingUserId = userId;

        document.getElementById("editUserId").value = userId;
        document.getElementById("editUsername").value = user.username || "";
        document.getElementById("editPhone").value = user.phoneNumber || "";
        document.getElementById("editPassword").value = "";
        document.getElementById("editBalance").value = user.balance || 0;
        document.getElementById("editStatus").value = user.status || "active";
        document.getElementById("editRole").value = user.role || "user";

        document.getElementById("editUserModal").classList.add("active");

        hideLoading();
      }

      // Close edit user modal
      document
        .getElementById("closeEditUserModal")
        .addEventListener("click", () => {
          document.getElementById("editUserModal").classList.remove("active");
        });

      document
        .getElementById("cancelEditUser")
        .addEventListener("click", () => {
          document.getElementById("editUserModal").classList.remove("active");
        });

      // Confirm edit user
      document
        .getElementById("confirmEditUser")
        .addEventListener("click", () => {
          const userId = document.getElementById("editUserId").value;
          const username = document.getElementById("editUsername").value.trim();
          const phone = document.getElementById("editPhone").value.trim();
          const password = document.getElementById("editPassword").value.trim();
          const balance =
            parseFloat(document.getElementById("editBalance").value) || 0;
          const status = document.getElementById("editStatus").value;
          const role = document.getElementById("editRole").value;

          // Validate inputs
          if (!username) {
            showToast("error", "Validation Error", "Username is required");
            return;
          }

          if (!phone) {
            showToast("error", "Validation Error", "Phone number is required");
            return;
          }

          showLoading();

          // Check if phone number already exists (excluding current user)
          database
            .ref(`investment/${mapKey}`)
            .orderByChild("phoneNumber")
            .equalTo(phone)
            .once("value")
            .then((snapshot) => {
              let phoneExists = false;

              snapshot.forEach((childSnapshot) => {
                if (childSnapshot.key !== userId) {
                  phoneExists = true;
                }
              });

              if (phoneExists) {
                showToast(
                  "error",
                  "Validation Error",
                  "Phone number already exists"
                );
                hideLoading();
                return Promise.reject("Phone number already exists");
              }

              // Prepare updates
              const updates = {
                username: username,
                phoneNumber: phone,
                balance: balance,
                status: status,
                role: role,
                updatedAt: new Date().getTime(),
                updatedBy: "admin",
              };

              // Only update password if provided
              if (password) {
                updates.password = password;
              }

              // Update user
              return database
                .ref(`investment/${mapKey}/${userId}`)
                .update(updates);
            })
            .then(() => {
              // Log the action
              logAction("user", "update", `Updated user: ${username}`);

              showToast("success", "Success", "User updated successfully");
              document
                .getElementById("editUserModal")
                .classList.remove("active");
              loadUsersData();
            })
            .catch((error) => {
              if (error !== "Phone number already exists") {
                console.error("Error updating user:", error);
                showToast("error", "Error", "Failed to update user");
              }
              hideLoading();
            });
        });

      // Delete user
      function deleteUser(userId) {
        const user = users.find((u) => u.key === userId);
        if (!user) {
          showToast("error", "Error", "User not found");
          return;
        }

        if (
          !confirm(
            `Are you sure you want to delete user "${user.username}"? This action cannot be undone.`
          )
        ) {
          return;
        }

        showLoading();

        database
          .ref(`investment/${mapKey}/${userId}`)
          .remove()
          .then(() => {
            // Log the action
            logAction("user", "delete", `Deleted user: ${user.username}`);

            showToast("success", "Success", "User deleted successfully");
            loadUsersData();
          })
          .catch((error) => {
            console.error("Error deleting user:", error);
            showToast("error", "Error", "Failed to delete user");
            hideLoading();
          });
      }

      // Load deposits data
      function loadDepositsData() {
        const table = document.getElementById("depositsTable");
        table.innerHTML =
          '<tr><td colspan="7" class="text-center">Loading deposits...</td></tr>';
        deposits = [];

        database
          .ref("payments")
          .orderByChild("timestamp")
          .once("value")
          .then((snapshot) => {
            deposits = [];

            snapshot.forEach((paymentSnapshot) => {
              const payment = paymentSnapshot.val();
              payment.key = paymentSnapshot.key;
              deposits.push(payment);
            });

            // Reverse to show newest first
            deposits.reverse();

            // Count pending deposits
            const pendingCount = deposits.filter(
              (d) => d.status === "pending"
            ).length;
            document.getElementById("pendingDepositsCount").textContent =
              pendingCount;
            document.getElementById("pendingDepositsCount").style.display =
              pendingCount > 0 ? "inline-block" : "none";

            // Update total deposits count
            document.getElementById("totalDepositsCount").textContent =
              deposits.length;

            // Apply pagination
            renderDepositsTable();

            hideLoading();
          })
          .catch((error) => {
            console.error("Error loading deposits:", error);
            table.innerHTML = `
                                      <tr>
                          <td colspan="7" class="text-center">Error loading deposits</td>
                      </tr>
                  `;
            showToast("error", "Error", "Failed to load deposits data");
            hideLoading();
          });
      }

      // Render deposits table with pagination
      function renderDepositsTable() {
        const table = document.getElementById("depositsTable");
        table.innerHTML = "";

        // Apply filters
        const statusFilter = document.getElementById(
          "depositStatusFilter"
        ).value;
        const dateFilter = document.getElementById("depositDateFilter").value;
        const searchFilter = document
          .getElementById("depositSearchFilter")
          .value.toLowerCase();

        let filteredDeposits = deposits.filter((deposit) => {
          // Status filter
          if (statusFilter && deposit.status !== statusFilter) {
            return false;
          }

          // Date filter
          if (dateFilter) {
            const now = new Date();
            const depositDate = new Date(deposit.timestamp);

            if (dateFilter === "today") {
              if (depositDate.toDateString() !== now.toDateString()) {
                return false;
              }
            } else if (dateFilter === "week") {
              const weekAgo = new Date();
              weekAgo.setDate(now.getDate() - 7);
              if (depositDate < weekAgo) {
                return false;
              }
            } else if (dateFilter === "month") {
              const monthAgo = new Date();
              monthAgo.setMonth(now.getMonth() - 1);
              if (depositDate < monthAgo) {
                return false;
              }
            }
          }

          // Search filter
          if (searchFilter) {
            const user = (deposit.senderName || "").toLowerCase();
            const amount = (deposit.amount || "").toString().toLowerCase();

            if (
              !user.includes(searchFilter) &&
              !amount.includes(searchFilter)
            ) {
              return false;
            }
          }

          return true;
        });

        // Calculate pagination
        const totalPages = Math.ceil(filteredDeposits.length / itemsPerPage);
        const startIndex = (currentPage.deposits - 1) * itemsPerPage;
        const endIndex = Math.min(
          startIndex + itemsPerPage,
          filteredDeposits.length
        );
        const paginatedDeposits = filteredDeposits.slice(startIndex, endIndex);

        // Update pagination info
        document.getElementById("depositsShowing").textContent =
          paginatedDeposits.length;
        document.getElementById("totalDepositsCount").textContent =
          filteredDeposits.length;

        // Enable/disable pagination buttons
        document.getElementById("prevDepositsPage").disabled =
          currentPage.deposits === 1;
        document.getElementById("nextDepositsPage").disabled =
          currentPage.deposits >= totalPages;

        // Render pagination numbers
        const paginationContainer =
          document.getElementById("depositsPagination");
        paginationContainer.innerHTML = "";

        for (let i = 1; i <= totalPages; i++) {
          const pageBtn = document.createElement("button");
          pageBtn.className = `pagination-btn ${
            i === currentPage.deposits ? "active" : ""
          }`;
          pageBtn.textContent = i;
          pageBtn.addEventListener("click", () => {
            currentPage.deposits = i;
            renderDepositsTable();
          });
          paginationContainer.appendChild(pageBtn);
        }

        // If no deposits found
        if (paginatedDeposits.length === 0) {
          table.innerHTML = `
                  <tr>
                      <td colspan="7" class="text-center">No deposits found</td>
                  </tr>
              `;
          return;
        }

        // Render deposits
        paginatedDeposits.forEach((deposit) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                  <td>${deposit.key.substring(0, 6)}</td>
                  <td>${deposit.senderName || "Unknown"}</td>
                  <td>₦${formatCurrency(deposit.amount)}</td>
                  <td>${deposit.senderAccount || "N/A"}</td>
                  <td>${formatDateTime(deposit.timestamp)}</td>
                  <td><span class="status-badge ${getStatusClass(
                    deposit.status
                  )}">${deposit.status}</span></td>
                  <td>
                      <button class="action-btn btn-primary view-deposit-btn" data-id="${
                        deposit.key
                      }">
                          <i class="fas fa-eye"></i> View
                      </button>
                      ${
                        deposit.status === "pending"
                          ? `
                      <button class="action-btn btn-success process-deposit-btn" data-id="${deposit.key}">
                          <i class="fas fa-check"></i> Process
                      </button>
                      `
                          : ""
                      }
                  </td>
              `;

          table.appendChild(row);
        });

        // Add event listeners to action buttons
        document.querySelectorAll(".view-deposit-btn").forEach((btn) => {
          btn.addEventListener("click", () =>
            viewDeposit(btn.getAttribute("data-id"))
          );
        });

        document.querySelectorAll(".process-deposit-btn").forEach((btn) => {
          btn.addEventListener("click", () =>
            viewDeposit(btn.getAttribute("data-id"))
          );
        });
      }

      // Load withdrawals data
      function loadWithdrawalsData() {
        const table = document.getElementById("withdrawalsTable");
        table.innerHTML =
          '<tr><td colspan="7" class="text-center">Loading withdrawals...</td></tr>';
        withdrawals = [];

        database
          .ref(`withdrawals/${mapKey}`)
          .orderByChild("timestamp")
          .once("value")
          .then((snapshot) => {
            withdrawals = [];

            snapshot.forEach((userSnapshot) => {
              userSnapshot.forEach((withdrawalSnapshot) => {
                const withdrawal = withdrawalSnapshot.val();
                withdrawal.key = withdrawalSnapshot.key;
                withdrawal.userId = userSnapshot.key;
                withdrawals.push(withdrawal);
              });
            });

            // Reverse to show newest first
            withdrawals.reverse();

            // Count pending withdrawals
            const pendingCount = withdrawals.filter(
              (w) => w.status === "pending"
            ).length;
            document.getElementById("pendingWithdrawalsCount").textContent =
              pendingCount;
            document.getElementById("pendingWithdrawalsCount").style.display =
              pendingCount > 0 ? "inline-block" : "none";

            // Update total withdrawals count
            document.getElementById("totalWithdrawalsCount").textContent =
              withdrawals.length;

            // Apply pagination
            renderWithdrawalsTable();

            hideLoading();
          })
          .catch((error) => {
            console.error("Error loading withdrawals:", error);
            table.innerHTML = `
                      <tr>
                          <td colspan="7" class="text-center">Error loading withdrawals</td>
                      </tr>
                  `;
            showToast("error", "Error", "Failed to load withdrawals data");
            hideLoading();
          });
      }

      // Render withdrawals table with pagination
      function renderWithdrawalsTable() {
        const table = document.getElementById("withdrawalsTable");
        table.innerHTML = "";

        // Apply filters
        const statusFilter = document.getElementById(
          "withdrawalStatusFilter"
        ).value;
        const dateFilter = document.getElementById(
          "withdrawalDateFilter"
        ).value;
        const searchFilter = document
          .getElementById("withdrawalSearchFilter")
          .value.toLowerCase();

        let filteredWithdrawals = withdrawals.filter((withdrawal) => {
          // Status filter
          if (statusFilter && withdrawal.status !== statusFilter) {
            return false;
          }

          // Date filter
          if (dateFilter) {
            const now = new Date();
            const withdrawalDate = new Date(withdrawal.timestamp);

            if (dateFilter === "today") {
              if (withdrawalDate.toDateString() !== now.toDateString()) {
                return false;
              }
            } else if (dateFilter === "week") {
              const weekAgo = new Date();
              weekAgo.setDate(now.getDate() - 7);
              if (withdrawalDate < weekAgo) {
                return false;
              }
            } else if (dateFilter === "month") {
              const monthAgo = new Date();
              monthAgo.setMonth(now.getMonth() - 1);
              if (withdrawalDate < monthAgo) {
                return false;
              }
            }
          }

          // Search filter
          if (searchFilter) {
            const user = (withdrawal.userName || "").toLowerCase();
            const amount = (withdrawal.amount || "").toString().toLowerCase();

            if (
              !user.includes(searchFilter) &&
              !amount.includes(searchFilter)
            ) {
              return false;
            }
          }

          return true;
        });

        // Calculate pagination
        const totalPages = Math.ceil(filteredWithdrawals.length / itemsPerPage);
        const startIndex = (currentPage.withdrawals - 1) * itemsPerPage;
        const endIndex = Math.min(
          startIndex + itemsPerPage,
          filteredWithdrawals.length
        );
        const paginatedWithdrawals = filteredWithdrawals.slice(
          startIndex,
          endIndex
        );

        // Update pagination info
        document.getElementById("withdrawalsShowing").textContent =
          paginatedWithdrawals.length;
        document.getElementById("totalWithdrawalsCount").textContent =
          filteredWithdrawals.length;

        // Enable/disable pagination buttons
        document.getElementById("prevWithdrawalsPage").disabled =
          currentPage.withdrawals === 1;
        document.getElementById("nextWithdrawalsPage").disabled =
          currentPage.withdrawals >= totalPages;

        // Render pagination numbers
        const paginationContainer = document.getElementById(
          "withdrawalsPagination"
        );
        paginationContainer.innerHTML = "";

        for (let i = 1; i <= totalPages; i++) {
          const pageBtn = document.createElement("button");
          pageBtn.className = `pagination-btn ${
            i === currentPage.withdrawals ? "active" : ""
          }`;
          pageBtn.textContent = i;
          pageBtn.addEventListener("click", () => {
            currentPage.withdrawals = i;
            renderWithdrawalsTable();
          });
          paginationContainer.appendChild(pageBtn);
        }

        // If no withdrawals found
        if (paginatedWithdrawals.length === 0) {
          table.innerHTML = `
                  <tr>
                      <td colspan="7" class="text-center">No withdrawals found</td>
                  </tr>
              `;
          return;
        }

        // Render withdrawals
        paginatedWithdrawals.forEach((withdrawal) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                  <td>${withdrawal.key.substring(0, 6)}</td>
                  <td>${withdrawal.userName || "Unknown"}</td>
                  <td>₦${formatCurrency(withdrawal.amount)}</td>
                  <td>${withdrawal.bankName || "N/A"} (${
            withdrawal.accountNumber || "N/A"
          })</td>
                  <td>${formatDateTime(withdrawal.timestamp)}</td>
                  <td><span class="status-badge ${getStatusClass(
                    withdrawal.status
                  )}">${withdrawal.status}</span></td>
                  <td>
                      <button class="action-btn btn-primary view-withdrawal-btn" data-id="${
                        withdrawal.key
                      }" data-user="${withdrawal.userId}">
                          <i class="fas fa-eye"></i> View
                      </button>
                      ${
                        withdrawal.status === "pending"
                          ? `
                      <button class="action-btn btn-success process-withdrawal-btn" data-id="${withdrawal.key}" data-user="${withdrawal.userId}">
                          <i class="fas fa-check"></i> Process
                      </button>
                      `
                          : ""
                      }
                  </td>
              `;

          table.appendChild(row);
        });

        // Add event listeners to action buttons
        document.querySelectorAll(".view-withdrawal-btn").forEach((btn) => {
          btn.addEventListener("click", () =>
            viewWithdrawal(
              btn.getAttribute("data-id"),
              btn.getAttribute("data-user")
            )
          );
        });

        document.querySelectorAll(".process-withdrawal-btn").forEach((btn) => {
          btn.addEventListener("click", () =>
            viewWithdrawal(
              btn.getAttribute("data-id"),
              btn.getAttribute("data-user")
            )
          );
        });
      }

      // View withdrawal details
      function viewWithdrawal(withdrawalId, userId) {
        showLoading();

        database
          .ref(`withdrawals/${mapKey}/${userId}/${withdrawalId}`)
          .once("value")
          .then((snapshot) => {
            const withdrawal = snapshot.val();
            if (withdrawal) {
              // Store current withdrawal ID for processing
              currentProcessingWithdrawalId = withdrawalId;
              currentProcessingWithdrawalUserId = userId;

              // Display withdrawal details
              const detailsDiv = document.getElementById("withdrawalDetails");
              detailsDiv.innerHTML = `
                          <div class="alert-icon"><i class="fas fa-info-circle"></i></div>
                          <div>
                              <p><strong>User:</strong> ${
                                withdrawal.userName || "Unknown"
                              }</p>
                              <p><strong>Amount:</strong> ₦${formatCurrency(
                                withdrawal.amount
                              )}</p>
                              <p><strong>Bank Details:</strong> ${
                                withdrawal.bankName || "N/A"
                              } (${withdrawal.accountNumber || "N/A"})</p>
                              <p><strong>Account Name:</strong> ${
                                withdrawal.accountName || "N/A"
                              }</p>
                              <p><strong>Date:</strong> ${formatDateTime(
                                withdrawal.timestamp
                              )}</p>
                              <p><strong>Current Status:</strong> <span class="status-badge ${getStatusClass(
                                withdrawal.status
                              )}">${withdrawal.status}</span></p>
                          </div>
                      `;

              // Show modal
              document
                .getElementById("withdrawalActionModal")
                .classList.add("active");
            } else {
              showToast("error", "Error", "Withdrawal not found");
            }

            hideLoading();
          })
          .catch((error) => {
            console.error("Error viewing withdrawal:", error);
            showToast("error", "Error", "Failed to load withdrawal details");
            hideLoading();
          });
      }

      // Load investments data
      function loadInvestmentsData() {
        const table = document.getElementById("investmentsTable");
        table.innerHTML =
          '<tr><td colspan="9" class="text-center">Loading investments...</td></tr>';
        investments = [];

        database
          .ref(`investments/${mapKey}`)
          .orderByChild("startDate")
          .once("value")
          .then((snapshot) => {
            investments = [];

            snapshot.forEach((userSnapshot) => {
              userSnapshot.forEach((investmentSnapshot) => {
                const investment = investmentSnapshot.val();
                investment.key = investmentSnapshot.key;
                investment.userId = userSnapshot.key;
                investments.push(investment);
              });
            });

            // Reverse to show newest first
            investments.reverse();

            // Update total investments count
            document.getElementById("totalInvestmentsCount").textContent =
              investments.length;

            // Apply pagination
            renderInvestmentsTable();

            hideLoading();
          })
          .catch((error) => {
            console.error("Error loading investments:", error);
            table.innerHTML = `
                      <tr>
                          <td colspan="9" class="text-center">Error loading investments</td>
                      </tr>
                  `;
            showToast("error", "Error", "Failed to load investments data");
            hideLoading();
          });
      }

      // Render investments table with pagination
      function renderInvestmentsTable() {
        const table = document.getElementById("investmentsTable");
        table.innerHTML = "";

        // Apply filters
        const statusFilter = document.getElementById(
          "investmentStatusFilter"
        ).value;
        const planFilter = document.getElementById(
          "investmentPlanFilter"
        ).value;
        const searchFilter = document
          .getElementById("investmentSearchFilter")
          .value.toLowerCase();

        let filteredInvestments = investments.filter((investment) => {
          // Status filter
          if (statusFilter && investment.status !== statusFilter) {
            return false;
          }

          // Plan filter
          if (planFilter && investment.planName !== planFilter) {
            return false;
          }

          // Search filter
          if (searchFilter) {
            const user = (investment.userName || "").toLowerCase();
            const amount = (investment.amount || "").toString().toLowerCase();

            if (
              !user.includes(searchFilter) &&
              !amount.includes(searchFilter)
            ) {
              return false;
            }
          }

          return true;
        });

        // Calculate pagination
        const totalPages = Math.ceil(filteredInvestments.length / itemsPerPage);
        const startIndex = (currentPage.investments - 1) * itemsPerPage;
        const endIndex = Math.min(
          startIndex + itemsPerPage,
          filteredInvestments.length
        );
        const paginatedInvestments = filteredInvestments.slice(
          startIndex,
          endIndex
        );

        // Update pagination info
        document.getElementById("investmentsShowing").textContent =
          paginatedInvestments.length;
        document.getElementById("totalInvestmentsCount").textContent =
          filteredInvestments.length;

        // Enable/disable pagination buttons
        document.getElementById("prevInvestmentsPage").disabled =
          currentPage.investments === 1;
        document.getElementById("nextInvestmentsPage").disabled =
          currentPage.investments >= totalPages;

        // Render pagination numbers
        const paginationContainer = document.getElementById(
          "investmentsPagination"
        );
        paginationContainer.innerHTML = "";

        for (let i = 1; i <= totalPages; i++) {
          const pageBtn = document.createElement("button");
          pageBtn.className = `pagination-btn ${
            i === currentPage.investments ? "active" : ""
          }`;
          pageBtn.textContent = i;
          pageBtn.addEventListener("click", () => {
            currentPage.investments = i;
            renderInvestmentsTable();
          });
          paginationContainer.appendChild(pageBtn);
        }

        // If no investments found
        if (paginatedInvestments.length === 0) {
          table.innerHTML = `
                  <tr>
                      <td colspan="9" class="text-center">No investments found</td>
                  </tr>
              `;
          return;
        }

        // Render investments
        paginatedInvestments.forEach((investment) => {
          // Calculate days left
          const startDate = new Date(investment.startDate);
          const endDate = new Date(startDate);
          endDate.setDate(startDate.getDate() + (investment.duration || 30));

          const today = new Date();
          const daysLeft = Math.max(
            0,
            Math.ceil((endDate - today) / (1000 * 60 * 60 * 24))
          );

          const row = document.createElement("tr");

          row.innerHTML = `
                  <td>${investment.key.substring(0, 6)}</td>
                  <td>${investment.userName || "Unknown"}</td>
                  <td>${investment.planName || "N/A"}</td>
                  <td>₦${formatCurrency(investment.amount)}</td>
                  <td>₦${formatCurrency(investment.dailyIncome || 0)}</td>
                  <td>${formatDate(investment.startDate)}</td>
                  <td>${daysLeft}</td>
                  <td><span class="status-badge ${getStatusClass(
                    investment.status
                  )}">${investment.status}</span></td>
                  <td>
                      <button class="action-btn btn-primary" data-id="${
                        investment.key
                      }" data-user="${investment.userId}">
                          <i class="fas fa-eye"></i> View
                      </button>
                      ${
                        investment.status === "active"
                          ? `
                      <button class="action-btn btn-danger cancel-investment-btn" data-id="${investment.key}" data-user="${investment.userId}">
                          <i class="fas fa-times"></i> Cancel
                      </button>
                      `
                          : ""
                      }
                  </td>
              `;

          table.appendChild(row);
        });

        // Add event listeners to action buttons
        document.querySelectorAll(".view-investment-btn").forEach((btn) => {
          btn.addEventListener("click", () =>
            viewInvestment(
              btn.getAttribute("data-id"),
              btn.getAttribute("data-user")
            )
          );
        });

        document.querySelectorAll(".cancel-investment-btn").forEach((btn) => {
          btn.addEventListener("click", () =>
            cancelInvestment(
              btn.getAttribute("data-id"),
              btn.getAttribute("data-user")
            )
          );
        });
      }

      // View investment details
      function viewInvestment(investmentId, userId) {
        showLoading();

        database
          .ref(`investments/${mapKey}/${userId}/${investmentId}`)
          .once("value")
          .then((snapshot) => {
            const investment = snapshot.val();
            if (investment) {
              // Display investment details in a modal or alert
              let message = `
                          <strong>User:</strong> ${
                            investment.userName || "Unknown"
                          }<br>
                          <strong>Plan:</strong> ${
                            investment.planName || "N/A"
                          }<br>
                          <strong>Amount:</strong> ₦${formatCurrency(
                            investment.amount
                          )}<br>
                          <strong>Daily Income:</strong> ₦${formatCurrency(
                            investment.dailyIncome || 0
                          )}<br>
                          <strong>Start Date:</strong> ${formatDate(
                            investment.startDate
                          )}<br>
                          <strong>Status:</strong> <span class="status-badge ${getStatusClass(
                            investment.status
                          )}">${investment.status}</span>
                      `;

              showToast("info", "Investment Details", message);
            } else {
              showToast("error", "Error", "Investment not found");
            }

            hideLoading();
          })
          .catch((error) => {
            console.error("Error viewing investment:", error);
            showToast("error", "Error", "Failed to load investment details");
            hideLoading();
          });
      }

      // Cancel investment
      function cancelInvestment(investmentId, userId) {
        const investment = investments.find(
          (i) => i.key === investmentId && i.userId === userId
        );
        if (!investment) {
          showToast("error", "Error", "Investment not found");
          return;
        }

        if (
          !confirm(
            `Are you sure you want to cancel this investment? The user will be refunded ₦${formatCurrency(
              investment.amount
            )}.`
          )
        ) {
          return;
        }

        showLoading();

        // Update investment status
        database
          .ref(`investments/${mapKey}/${userId}/${investmentId}`)
          .update({
            status: "cancelled",
            endDate: new Date().getTime(),
            cancelledBy: "admin",
          })
          .then(() => {
            // Refund user
            return database
              .ref(`investment/${mapKey}/${userId}/balance`)
              .transaction((balance) => {
                return (
                  (parseFloat(balance) || 0) + parseFloat(investment.amount)
                );
              });
          })
          .then(() => {
            // Log the action
            logAction(
              "investment",
              "cancel",
              `Cancelled investment for user ${investment.userName}`
            );

            showToast(
              "success",
              "Success",
              "Investment cancelled and user refunded"
            );
            loadInvestmentsData();
          })
          .catch((error) => {
            console.error("Error cancelling investment:", error);
            showToast("error", "Error", "Failed to cancel investment");
            hideLoading();
          });
      }

      // Load referrals data
      function loadReferralsData() {
        const table = document.getElementById("referralsTable");
        table.innerHTML =
          '<tr><td colspan="7" class="text-center">Loading referrals...</td></tr>';
        referrals = [];

        database
          .ref(`referrals/${mapKey}`)
          .orderByChild("timestamp")
          .once("value")
          .then((snapshot) => {
            referrals = [];

            snapshot.forEach((referralSnapshot) => {
              const referral = referralSnapshot.val();
              referral.key = referralSnapshot.key;
              referrals.push(referral);
            });

            // Reverse to show newest first
            referrals.reverse();

            // Update stats
            document.getElementById("totalReferrals").textContent =
              referrals.length;

            const pendingRewards = referrals.filter(
              (r) => r.status === "pending"
            ).length;
            document.getElementById("pendingReferralRewards").textContent =
              pendingRewards;

            let totalRewards = 0;
            referrals.forEach((r) => {
              if (r.status === "paid") {
                totalRewards += parseFloat(r.rewardAmount || 0);
              }
            });
            document.getElementById("totalReferralRewards").textContent =
              formatCurrency(totalRewards);

            // Find top referrer
            const referrerCounts = {};
            referrals.forEach((r) => {
              if (r.referrerId) {
                referrerCounts[r.referrerId] =
                  (referrerCounts[r.referrerId] || 0) + 1;
              }
            });

            let topReferrerId = null;
            let maxCount = 0;
            for (const [id, count] of Object.entries(referrerCounts)) {
              if (count > maxCount) {
                maxCount = count;
                topReferrerId = id;
              }
            }

            if (topReferrerId) {
              database
                .ref(`investment/${mapKey}/${topReferrerId}`)
                .once("value")
                .then((userSnapshot) => {
                  const user = userSnapshot.val();
                  document.getElementById("topReferrer").textContent =
                    user.username || "Unknown";
                  document.getElementById("topReferrerCount").textContent =
                    maxCount;
                });
            } else {
              document.getElementById("topReferrer").textContent = "-";
              document.getElementById("topReferrerCount").textContent = "0";
            }

            // Update total referrals count
            document.getElementById("totalReferralsCount").textContent =
              referrals.length;

            // Apply pagination
            renderReferralsTable();

            hideLoading();
          })
          .catch((error) => {
            console.error("Error loading referrals:", error);
            table.innerHTML = `
                      <tr>
                          <td colspan="7" class="text-center">Error loading referrals</td>
                      </tr>
                  `;
            showToast("error", "Error", "Failed to load referrals data");
            hideLoading();
          });
      }

      // Render referrals table with pagination
      function renderReferralsTable() {
        const table = document.getElementById("referralsTable");
        table.innerHTML = "";

        // Calculate pagination
        const totalPages = Math.ceil(referrals.length / itemsPerPage);
        const startIndex = (currentPage.referrals - 1) * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, referrals.length);
        const paginatedReferrals = referrals.slice(startIndex, endIndex);

        // Update pagination info
        document.getElementById("referralsShowing").textContent =
          paginatedReferrals.length;
        document.getElementById("totalReferralsCount").textContent =
          referrals.length;

        // Enable/disable pagination buttons
        document.getElementById("prevReferralsPage").disabled =
          currentPage.referrals === 1;
        document.getElementById("nextReferralsPage").disabled =
          currentPage.referrals >= totalPages;

        // Render pagination numbers
        const paginationContainer = document.getElementById(
          "referralsPagination"
        );
        paginationContainer.innerHTML = "";

        for (let i = 1; i <= totalPages; i++) {
          const pageBtn = document.createElement("button");
          pageBtn.className = `pagination-btn ${
            i === currentPage.referrals ? "active" : ""
          }`;
          pageBtn.textContent = i;
          pageBtn.addEventListener("click", () => {
            currentPage.referrals = i;
            renderReferralsTable();
          });
          paginationContainer.appendChild(pageBtn);
        }

        // If no referrals found
        if (paginatedReferrals.length === 0) {
          table.innerHTML = `
                  <tr>
                      <td colspan="7" class="text-center">No referrals found</td>
                  </tr>
              `;
          return;
        }

        // Render referrals
        paginatedReferrals.forEach((referral) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                  <td>${referral.key.substring(0, 6)}</td>
                  <td>${referral.referrerName || "Unknown"}</td>
                  <td>${referral.referredName || "Unknown"}</td>
                  <td>${formatDate(referral.timestamp)}</td>
                  <td><span class="status-badge ${getStatusClass(
                    referral.status
                  )}">${referral.status}</span></td>
                  <td>${
                    referral.rewardAmount
                      ? "₦" + formatCurrency(referral.rewardAmount)
                      : "N/A"
                  }</td>
                  <td>
                      ${
                        referral.status === "pending"
                          ? `
                      <button class="action-btn btn-success pay-referral-btn" data-id="${referral.key}">
                          <i class="fas fa-check"></i> Pay
                      </button>
                      `
                          : ""
                      }
                  </td>
              `;

          table.appendChild(row);
        });

        // Add event listeners to pay buttons
        document.querySelectorAll(".pay-referral-btn").forEach((btn) => {
          btn.addEventListener("click", () =>
            payReferralReward(btn.getAttribute("data-id"))
          );
        });
      }

      // Pay referral reward
      function payReferralReward(referralId) {
        const referral = referrals.find((r) => r.key === referralId);
        if (!referral) {
          showToast("error", "Error", "Referral not found");
          return;
        }

        if (
          !confirm(
            `Are you sure you want to pay ₦${formatCurrency(
              referral.rewardAmount || 0
            )} to ${referral.referrerName || "the referrer"}?`
          )
        ) {
          return;
        }

        showLoading();

        // Update referral status
        database
          .ref(`referrals/${mapKey}/${referralId}`)
          .update({
            status: "paid",
            paidDate: new Date().getTime(),
          })
          .then(() => {
            // Add reward to referrer's balance
            return database
              .ref(`investment/${mapKey}/${referral.referrerId}/balance`)
              .transaction((balance) => {
                return (
                  (parseFloat(balance) || 0) +
                  parseFloat(referral.rewardAmount || 0)
                );
              });
          })
          .then(() => {
            // Log the action
            logAction(
              "referral",
              "pay",
              `Paid referral reward to ${referral.referrerName}`
            );

            showToast(
              "success",
              "Success",
              "Referral reward paid successfully"
            );
            loadReferralsData();
          })
          .catch((error) => {
            console.error("Error paying referral reward:", error);
            showToast("error", "Error", "Failed to pay referral reward");
            hideLoading();
          });
      }

      // Load logs data
      function loadLogsData() {
        const table = document.getElementById("logsTable");
        table.innerHTML =
          '<tr><td colspan="7" class="text-center">Loading logs...</td></tr>';
        logs = [];

        database
          .ref("adminLogs")
          .orderByChild("timestamp")
          .once("value")
          .then((snapshot) => {
            logs = [];

            snapshot.forEach((logSnapshot) => {
              const log = logSnapshot.val();
              log.key = logSnapshot.key;
              logs.push(log);
            });

            // Reverse to show newest first
            logs.reverse();

            // Update total logs count
            document.getElementById("totalLogsCount").textContent = logs.length;

            // Apply pagination
            renderLogsTable();

            hideLoading();
          })
          .catch((error) => {
            console.error("Error loading logs:", error);
            table.innerHTML = `
                      <tr>
                          <td colspan="7" class="text-center">Error loading logs</td>
                      </tr>
                  `;
            showToast("error", "Error", "Failed to load logs data");
            hideLoading();
          });
      }

      // Render logs table with pagination
      function renderLogsTable() {
        const table = document.getElementById("logsTable");
        table.innerHTML = "";

        // Apply filters
        const typeFilter = document.getElementById("logTypeFilter").value;
        const dateFilter = document.getElementById("logDateFilter").value;
        const searchFilter = document
          .getElementById("logSearchFilter")
          .value.toLowerCase();

        let filteredLogs = logs.filter((log) => {
          // Type filter
          if (typeFilter && log.type !== typeFilter) {
            return false;
          }

          // Date filter
          if (dateFilter) {
            const now = new Date();
            const logDate = new Date(log.timestamp);

            if (dateFilter === "today") {
              if (logDate.toDateString() !== now.toDateString()) {
                return false;
              }
            } else if (dateFilter === "week") {
              const weekAgo = new Date();
              weekAgo.setDate(now.getDate() - 7);
              if (logDate < weekAgo) {
                return false;
              }
            } else if (dateFilter === "month") {
              const monthAgo = new Date();
              monthAgo.setMonth(now.getMonth() - 1);
              if (logDate < monthAgo) {
                return false;
              }
            }
          }

          // Search filter
          if (searchFilter) {
            const action = (log.action || "").toLowerCase();
            const user = (log.userName || "").toLowerCase();

            if (
              !action.includes(searchFilter) &&
              !user.includes(searchFilter)
            ) {
              return false;
            }
          }

          return true;
        });

        // Calculate pagination
        const totalPages = Math.ceil(filteredLogs.length / itemsPerPage);
        const startIndex = (currentPage.logs - 1) * itemsPerPage;
        const endIndex = Math.min(
          startIndex + itemsPerPage,
          filteredLogs.length
        );
        const paginatedLogs = filteredLogs.slice(startIndex, endIndex);

        // Update pagination info
        document.getElementById("logsShowing").textContent =
          paginatedLogs.length;
        document.getElementById("totalLogsCount").textContent =
          filteredLogs.length;

        // Enable/disable pagination buttons
        document.getElementById("prevLogsPage").disabled =
          currentPage.logs === 1;
        document.getElementById("nextLogsPage").disabled =
          currentPage.logs >= totalPages;

        // Render pagination numbers
        const paginationContainer = document.getElementById("logsPagination");
        paginationContainer.innerHTML = "";

        for (let i = 1; i <= totalPages; i++) {
          const pageBtn = document.createElement("button");
          pageBtn.className = `pagination-btn ${
            i === currentPage.logs ? "active" : ""
          }`;
          pageBtn.textContent = i;
          pageBtn.addEventListener("click", () => {
            currentPage.logs = i;
            renderLogsTable();
          });
          paginationContainer.appendChild(pageBtn);
        }

        // If no logs found
        if (paginatedLogs.length === 0) {
          table.innerHTML = `
                  <tr>
                      <td colspan="7" class="text-center">No logs found</td>
                  </tr>
              `;
          return;
        }

        // Render logs
        paginatedLogs.forEach((log) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                  <td>${log.key.substring(0, 6)}</td>
                  <td>${log.type || "N/A"}</td>
                  <td>${log.userName || "System"}</td>
                  <td>${log.action || "N/A"}</td>
                  <td>${log.ipAddress || "N/A"}</td>
                  <td>${formatDateTime(log.timestamp)}</td>
                  <td>${log.details || "N/A"}</td>
              `;

          table.appendChild(row);
        });
      }

      // Clear logs
      document.getElementById("clearLogsBtn").addEventListener("click", () => {
        if (
          !confirm(
            "Are you sure you want to clear all logs? This action cannot be undone."
          )
        ) {
          return;
        }

        showLoading();

        database
          .ref("adminLogs")
          .remove()
          .then(() => {
            showToast("success", "Success", "All logs cleared successfully");
            loadLogsData();
          })
          .catch((error) => {
            console.error("Error clearing logs:", error);
            showToast("error", "Error", "Failed to clear logs");
            hideLoading();
          });
      });

      // Load settings data
      function loadSettingsData() {
        showLoading();

        database
          .ref("settings")
          .once("value")
          .then((snapshot) => {
            const settings = snapshot.val() || {};

            // Populate form fields
            document.getElementById("siteName").value =
              settings.siteName || "Facebook Investment";
            document.getElementById("minimumDeposit").value =
              settings.minimumDeposit || 5000;
            document.getElementById("minimumWithdrawal").value =
              settings.minimumWithdrawal || 2000;
            document.getElementById("referralBonus").value =
              settings.referralBonus || 300;
            document.getElementById("adminEmail").value =
              settings.adminEmail || "admin@facebookinvestment.com";
            document.getElementById("maintenanceMode").value =
              settings.maintenanceMode || "off";
            document.getElementById("bankDetails").value =
              settings.bankDetails || "";
            document.getElementById("notificationMessage").value =
              settings.notificationMessage || "";

            // Load investment plans
            loadInvestmentPlans();

            hideLoading();
          })
          .catch((error) => {
            console.error("Error loading settings:", error);
            showToast("error", "Error", "Failed to load settings");
            hideLoading();
          });
      }

      // Load investment plans
      function loadInvestmentPlans() {
        database
          .ref("investmentPlans")
          .once("value")
          .then((snapshot) => {
            const plansTable = document.getElementById("plansTable");
            plansTable.innerHTML = "";

            plans = [];
            snapshot.forEach((planSnapshot) => {
              const plan = planSnapshot.val();
              plan.key = planSnapshot.key;
              plans.push(plan);

              // Add plan to the table
              const row = document.createElement("tr");

              row.innerHTML = `
                      <td>${plan.name}</td>
                      <td>₦${formatCurrency(plan.minAmount)}</td>
                      <td>₦${formatCurrency(plan.maxAmount)}</td>
                      <td>${plan.dailyReturn}%</td>
                      <td>${plan.duration}</td>
                      <td><span class="status-badge ${getStatusClass(
                        plan.status
                      )}">${plan.status}</span></td>
                      <td>
                          <button class="action-btn btn-primary edit-plan-btn" data-id="${
                            plan.key
                          }">
                              <i class="fas fa-edit"></i> Edit
                          </button>
                          <button class="action-btn btn-danger delete-plan-btn" data-id="${
                            plan.key
                          }">
                              <i class="fas fa-trash"></i> Delete
                          </button>
                      </td>
                  `;

              plansTable.appendChild(row);
            });

            // Add event listeners to plan action buttons
            document.querySelectorAll(".edit-plan-btn").forEach((btn) => {
              btn.addEventListener("click", () =>
                openEditPlanModal(btn.getAttribute("data-id"))
              );
            });

            document.querySelectorAll(".delete-plan-btn").forEach((btn) => {
              btn.addEventListener("click", () =>
                deletePlan(btn.getAttribute("data-id"))
              );
            });

            // Update plan filter dropdown
            const planFilter = document.getElementById("investmentPlanFilter");
            planFilter.innerHTML = '<option value="">All Plans</option>';
            plans.forEach((plan) => {
              const option = document.createElement("option");
              option.value = plan.name;
              option.textContent = plan.name;
              planFilter.appendChild(option);
            });
          })
          .catch((error) => {
            console.error("Error loading investment plans:", error);
            showToast("error", "Error", "Failed to load investment plans");
          });
      }

      // Open add plan modal
      document.getElementById("addPlanBtn").addEventListener("click", () => {
        document.getElementById("planId").value = "";
        document.getElementById("planModalTitle").textContent =
          "Add Investment Plan";
        document.getElementById("investmentPlanForm").reset();
        document.getElementById("investmentPlanModal").classList.add("active");
      });

      // Close investment plan modal
      document
        .getElementById("closeInvestmentPlanModal")
        .addEventListener("click", () => {
          document
            .getElementById("investmentPlanModal")
            .classList.remove("active");
        });

      document
        .getElementById("cancelInvestmentPlan")
        .addEventListener("click", () => {
          document
            .getElementById("investmentPlanModal")
            .classList.remove("active");
        });

      // Confirm save investment plan
      document
        .getElementById("confirmInvestmentPlan")
        .addEventListener("click", () => {
          const planId = document.getElementById("planId").value;
          const name = document.getElementById("planName").value.trim();
          const minAmount =
            parseFloat(document.getElementById("planMinAmount").value) || 0;
          const maxAmount =
            parseFloat(document.getElementById("planMaxAmount").value) || 0;
          const dailyReturn =
            parseFloat(document.getElementById("planDailyReturn").value) || 0;
          const duration =
            parseInt(document.getElementById("planDuration").value) || 0;
          const status = document.getElementById("planStatus").value;
          const description = document
            .getElementById("planDescription")
            .value.trim();

          // Validate inputs
          if (!name) {
            showToast("error", "Validation Error", "Plan name is required");
            return;
          }

          if (minAmount <= 0) {
            showToast(
              "error",
              "Validation Error",
              "Minimum amount must be greater than 0"
            );
            return;
          }

          if (maxAmount <= minAmount) {
            showToast(
              "error",
              "Validation Error",
              "Maximum amount must be greater than minimum amount"
            );
            return;
          }

          if (dailyReturn <= 0) {
            showToast(
              "error",
              "Validation Error",
              "Daily return must be greater than 0"
            );
            return;
          }

          if (duration <= 0) {
            showToast(
              "error",
              "Validation Error",
              "Duration must be greater than 0"
            );
            return;
          }

          showLoading();

          const planData = {
            name: name,
            minAmount: minAmount,
            maxAmount: maxAmount,
            dailyReturn: dailyReturn,
            duration: duration,
            status: status,
            description: description,
            updatedAt: new Date().getTime(),
          };

          if (planId) {
            // Update existing plan
            database
              .ref(`investmentPlans/${planId}`)
              .update(planData)
              .then(() => {
                showToast("success", "Success", "Plan updated successfully");
                document
                  .getElementById("investmentPlanModal")
                  .classList.remove("active");
                loadSettingsData();
              })
              .catch((error) => {
                console.error("Error updating plan:", error);
                showToast("error", "Error", "Failed to update plan");
                hideLoading();
              });
          } else {
            // Add new plan
            database
              .ref("investmentPlans")
              .push(planData)
              .then(() => {
                showToast("success", "Success", "Plan added successfully");
                document
                  .getElementById("investmentPlanModal")
                  .classList.remove("active");
                loadSettingsData();
              })
              .catch((error) => {
                console.error("Error adding plan:", error);
                showToast("error", "Error", "Failed to add plan");
                hideLoading();
              });
          }
        });

      // Open edit plan modal
      function openEditPlanModal(planId) {
        const plan = plans.find((p) => p.key === planId);
        if (!plan) {
          showToast("error", "Error", "Plan not found");
          return;
        }

        document.getElementById("planId").value = plan.key;
        document.getElementById("planModalTitle").textContent =
          "Edit Investment Plan";
        document.getElementById("planName").value = plan.name || "";
        document.getElementById("planMinAmount").value = plan.minAmount || 0;
        document.getElementById("planMaxAmount").value = plan.maxAmount || 0;
        document.getElementById("planDailyReturn").value =
          plan.dailyReturn || 0;
        document.getElementById("planDuration").value = plan.duration || 0;
        document.getElementById("planStatus").value = plan.status || "active";
        document.getElementById("planDescription").value =
          plan.description || "";

        document.getElementById("investmentPlanModal").classList.add("active");
      }

      // Delete plan
      function deletePlan(planId) {
        const plan = plans.find((p) => p.key === planId);
        if (!plan) {
          showToast("error", "Error", "Plan not found");
          return;
        }

        if (
          !confirm(
            `Are you sure you want to delete the "${plan.name}" plan? This action cannot be undone.`
          )
        ) {
          return;
        }

        showLoading();

        database
          .ref(`investmentPlans/${planId}`)
          .remove()
          .then(() => {
            showToast("success", "Success", "Plan deleted successfully");
            loadSettingsData();
          })
          .catch((error) => {
            console.error("Error deleting plan:", error);
            showToast("error", "Error", "Failed to delete plan");
            hideLoading();
          });
      }

      // Save settings
      document
        .getElementById("saveSettingsBtn")
        .addEventListener("click", () => {
          const settings = {
            siteName: document.getElementById("siteName").value.trim(),
            minimumDeposit:
              parseFloat(document.getElementById("minimumDeposit").value) || 0,
            minimumWithdrawal:
              parseFloat(document.getElementById("minimumWithdrawal").value) ||
              0,
            referralBonus:
              parseFloat(document.getElementById("referralBonus").value) || 0,
            adminEmail: document.getElementById("adminEmail").value.trim(),
            maintenanceMode: document.getElementById("maintenanceMode").value,
            bankDetails: document.getElementById("bankDetails").value.trim(),
            notificationMessage: document
              .getElementById("notificationMessage")
              .value.trim(),
            updatedAt: new Date().getTime(),
          };

          showLoading();

          database
            .ref("settings")
            .update(settings)
            .then(() => {
              showToast("success", "Success", "Settings saved successfully");
              hideLoading();
            })
            .catch((error) => {
              console.error("Error saving settings:", error);
              showToast("error", "Error", "Failed to save settings");
              hideLoading();
            });
        });

      // Process deposit action
      document
        .getElementById("depositAction")
        .addEventListener("change", (e) => {
          document.getElementById("rejectReasonGroup").style.display =
            e.target.value === "reject" ? "block" : "none";
        });

      document
        .getElementById("confirmDepositAction")
        .addEventListener("click", () => {
          const action = document.getElementById("depositAction").value;
          const rejectReason = document
            .getElementById("rejectReason")
            .value.trim();
          const notifyUser = document.getElementById("notifyUser").checked;

          if (action === "reject" && !rejectReason) {
            showToast(
              "error",
              "Validation Error",
              "Please provide a reason for rejection"
            );
            return;
          }

          showLoading();

          const updates = {
            status: action === "approve" ? "approved" : "rejected",
            processedAt: new Date().getTime(),
            processedBy: "admin",
          };

          if (action === "reject") {
            updates.rejectReason = rejectReason;
          }

          database
            .ref(`payments/${currentProcessingDepositId}`)
            .update(updates)
            .then(() => {
              if (action === "approve") {
                // Get deposit amount and update user balance
                return database
                  .ref(`payments/${currentProcessingDepositId}`)
                  .once("value")
                  .then((snapshot) => {
                    const deposit = snapshot.val();
                    return database
                      .ref(`investment/${mapKey}/${deposit.senderId}/balance`)
                      .transaction((balance) => {
                        return (
                          (parseFloat(balance) || 0) +
                          parseFloat(deposit.amount)
                        );
                      });
                  });
              }
            })
            .then(() => {
              // Log the action
              logAction(
                "deposit",
                action,
                `Deposit ${action}d: ${currentProcessingDepositId}`
              );

              showToast(
                "success",
                "Success",
                `Deposit ${action}d successfully`
              );
              document
                .getElementById("depositActionModal")
                .classList.remove("active");

              // Reload deposits data
              loadDepositsData();

              // Notify user (in a real app)
              if (notifyUser) {
                showToast(
                  "info",
                  "Notification",
                  `User notified about ${action}`
                );
              }
            })
            .catch((error) => {
              console.error(`Error ${action}ing deposit:`, error);
              showToast("error", "Error", `Failed to ${action} deposit`);
              hideLoading();
            });
        });

      // Process withdrawal action
      document
        .getElementById("withdrawalAction")
        .addEventListener("change", (e) => {
          document.getElementById("withdrawalRejectReasonGroup").style.display =
            e.target.value === "reject" ? "block" : "none";
        });

      document
        .getElementById("confirmWithdrawalAction")
        .addEventListener("click", () => {
          const action = document.getElementById("withdrawalAction").value;
          const rejectReason = document
            .getElementById("withdrawalRejectReason")
            .value.trim();
          const notifyUser = document.getElementById(
            "notifyWithdrawalUser"
          ).checked;
          const transactionProof =
            document.getElementById("transactionProof").files[0];

          if (action === "reject" && !rejectReason) {
            showToast(
              "error",
              "Validation Error",
              "Please provide a reason for rejection"
            );
            return;
          }

          showLoading();

          const updates = {
            status: action === "approve" ? "approved" : "rejected",
            processedAt: new Date().getTime(),
            processedBy: "admin",
          };

          if (action === "reject") {
            updates.rejectReason = rejectReason;
          }

          // First update the withdrawal status
          database
            .ref(
              `withdrawals/${mapKey}/${currentProcessingWithdrawalUserId}/${currentProcessingWithdrawalId}`
            )
            .update(updates)
            .then(() => {
              // Log the action
              logAction(
                "withdrawal",
                action,
                `Withdrawal ${action}d: ${currentProcessingWithdrawalId}`
              );

              showToast(
                "success",
                "Success",
                `Withdrawal ${action}d successfully`
              );
              document
                .getElementById("withdrawalActionModal")
                .classList.remove("active");

              // Reload withdrawals data
              loadWithdrawalsData();

              // Notify user (in a real app)
              if (notifyUser) {
                showToast(
                  "info",
                  "Notification",
                  `User notified about ${action}`
                );
              }
            })
            .catch((error) => {
              console.error(`Error ${action}ing withdrawal:`, error);
              showToast("error", "Error", `Failed to ${action} withdrawal`);
              hideLoading();
            });
        });

      // Log admin action
      function logAction(type, action, details) {
        const logData = {
          type: type,
          action: action,
          details: details,
          timestamp: new Date().getTime(),
          admin: "Admin User",
          ipAddress: "127.0.0.1", // In a real app, you would get the actual IP
        };

        database.ref("adminLogs").push(logData);
      }

      // Clear filters
      document
        .getElementById("clearUserFiltersBtn")
        .addEventListener("click", () => {
          document.getElementById("userStatusFilter").value = "";
          document.getElementById("userDateFilter").value = "";
          document.getElementById("userSearchFilter").value = "";
          renderUsersTable();
        });

      document
        .getElementById("clearDepositFiltersBtn")
        .addEventListener("click", () => {
          document.getElementById("depositStatusFilter").value = "";
          document.getElementById("depositDateFilter").value = "";
          document.getElementById("depositSearchFilter").value = "";
          renderDepositsTable();
        });

      document
        .getElementById("clearWithdrawalFiltersBtn")
        .addEventListener("click", () => {
          document.getElementById("withdrawalStatusFilter").value = "";
          document.getElementById("withdrawalDateFilter").value = "";
          document.getElementById("withdrawalSearchFilter").value = "";
          renderWithdrawalsTable();
        });

      document
        .getElementById("clearInvestmentFiltersBtn")
        .addEventListener("click", () => {
          document.getElementById("investmentStatusFilter").value = "";
          document.getElementById("investmentPlanFilter").value = "";
          document.getElementById("investmentSearchFilter").value = "";
          renderInvestmentsTable();
        });

      document
        .getElementById("clearLogFiltersBtn")
        .addEventListener("click", () => {
          document.getElementById("logTypeFilter").value = "";
          document.getElementById("logDateFilter").value = "";
          document.getElementById("logSearchFilter").value = "";
          renderLogsTable();
        });

      // Refresh buttons
      document
        .getElementById("refreshDashboardBtn")
        .addEventListener("click", loadDashboardData);
      document
        .getElementById("refreshUsersBtn")
        .addEventListener("click", loadUsersData);
      document
        .getElementById("refreshDepositsBtn")
        .addEventListener("click", loadDepositsData);
      document
        .getElementById("refreshWithdrawalsBtn")
        .addEventListener("click", loadWithdrawalsData);
      document
        .getElementById("refreshInvestmentsBtn")
        .addEventListener("click", loadInvestmentsData);
      document
        .getElementById("refreshReferralsBtn")
        .addEventListener("click", loadReferralsData);
      document
        .getElementById("refreshLogsBtn")
        .addEventListener("click", loadLogsData);
      document
        .getElementById("refreshActivityBtn")
        .addEventListener("click", loadRecentActivity);

      // Pagination buttons
      document.getElementById("prevUsersPage").addEventListener("click", () => {
        if (currentPage.users > 1) {
          currentPage.users--;
          renderUsersTable();
        }
      });

      document.getElementById("nextUsersPage").addEventListener("click", () => {
        currentPage.users++;
        renderUsersTable();
      });

      document
        .getElementById("prevDepositsPage")
        .addEventListener("click", () => {
          if (currentPage.deposits > 1) {
            currentPage.deposits--;
            renderDepositsTable();
          }
        });

      document
        .getElementById("nextDepositsPage")
        .addEventListener("click", () => {
          currentPage.deposits++;
          renderDepositsTable();
        });

      document
        .getElementById("prevWithdrawalsPage")
        .addEventListener("click", () => {
          if (currentPage.withdrawals > 1) {
            currentPage.withdrawals--;
            renderWithdrawalsTable();
          }
        });

      document
        .getElementById("nextWithdrawalsPage")
        .addEventListener("click", () => {
          currentPage.withdrawals++;
          renderWithdrawalsTable();
        });

      document
        .getElementById("prevInvestmentsPage")
        .addEventListener("click", () => {
          if (currentPage.investments > 1) {
            currentPage.investments--;
            renderInvestmentsTable();
          }
        });

      document
        .getElementById("nextInvestmentsPage")
        .addEventListener("click", () => {
          currentPage.investments++;
          renderInvestmentsTable();
        });

      document
        .getElementById("prevReferralsPage")
        .addEventListener("click", () => {
          if (currentPage.referrals > 1) {
            currentPage.referrals--;
            renderReferralsTable();
          }
        });

      document
        .getElementById("nextReferralsPage")
        .addEventListener("click", () => {
          currentPage.referrals++;
          renderReferralsTable();
        });

      document.getElementById("prevLogsPage").addEventListener("click", () => {
        if (currentPage.logs > 1) {
          currentPage.logs--;
          renderLogsTable();
        }
      });

      document.getElementById("nextLogsPage").addEventListener("click", () => {
        currentPage.logs++;
        renderLogsTable();
      });

      // Export buttons
      document
        .getElementById("exportReportBtn")
        .addEventListener("click", () => {
          showToast("info", "Export", "Dashboard report export started");
          // In a real app, this would generate and download a report
        });

      document
        .getElementById("exportUsersBtn")
        .addEventListener("click", () => {
          showToast("info", "Export", "Users data export started");
          // In a real app, this would generate and download a CSV
        });

      document
        .getElementById("exportDepositsBtn")
        .addEventListener("click", () => {
          showToast("info", "Export", "Deposits data export started");
          // In a real app, this would generate and download a CSV
        });

      document
        .getElementById("exportWithdrawalsBtn")
        .addEventListener("click", () => {
          showToast("info", "Export", "Withdrawals data export started");
          // In a real app, this would generate and download a CSV
        });

      document
        .getElementById("exportInvestmentsBtn")
        .addEventListener("click", () => {
          showToast("info", "Export", "Investments data export started");
          // In a real app, this would generate and download a CSV
        });

      document
        .getElementById("exportReferralsBtn")
        .addEventListener("click", () => {
          showToast("info", "Export", "Referrals data export started");
          // In a real app, this would generate and download a CSV
        });

      document.getElementById("exportLogsBtn").addEventListener("click", () => {
        showToast("info", "Export", "Logs data export started");
        // In a real app, this would generate and download a CSV
      });

      // Manual deposit
      document
        .getElementById("manualDepositBtn")
        .addEventListener("click", () => {
          // Load users for dropdown
          database
            .ref(`investment/${mapKey}`)
            .once("value")
            .then((snapshot) => {
              const userSelect = document.getElementById("depositUser");
              userSelect.innerHTML = '<option value="">Select a user</option>';

              snapshot.forEach((userSnapshot) => {
                const user = userSnapshot.val();
                const option = document.createElement("option");
                option.value = userSnapshot.key;
                option.textContent = `${user.username} (${user.phoneNumber})`;
                userSelect.appendChild(option);
              });

              document
                .getElementById("manualDepositModal")
                .classList.add("active");
            })
            .catch((error) => {
              console.error("Error loading users for manual deposit:", error);
              showToast("error", "Error", "Failed to load users");
            });
        });

      document
        .getElementById("confirmManualDeposit")
        .addEventListener("click", () => {
          const userId = document.getElementById("depositUser").value;
          const amount =
            parseFloat(document.getElementById("depositAmount").value) || 0;
          const note = document.getElementById("depositNote").value.trim();
          const notifyUser =
            document.getElementById("notifyDepositUser").checked;

          if (!userId) {
            showToast("error", "Validation Error", "Please select a user");
            return;
          }

          if (amount <= 0) {
            showToast(
              "error",
              "Validation Error",
              "Amount must be greater than 0"
            );
            return;
          }

          showLoading();

          // Update user balance
          database
            .ref(`investment/${mapKey}/${userId}/balance`)
            .transaction((balance) => {
              return (parseFloat(balance) || 0) + amount;
            })
            .then(() => {
              // Create deposit record
              return database.ref("payments").push({
                amount: amount,
                senderId: userId,
                senderName: document
                  .getElementById("depositUser")
                  .options[
                    document.getElementById("depositUser").selectedIndex
                  ].text.split(" (")[0],
                status: "approved",
                timestamp: new Date().getTime(),
                processedAt: new Date().getTime(),
                processedBy: "admin",
                note: note,
                isManual: true,
              });
            })
            .then(() => {
              // Log the action
              logAction(
                "deposit",
                "manual",
                `Added manual deposit of ₦${amount} for user ${userId}`
              );

              showToast(
                "success",
                "Success",
                "Manual deposit added successfully"
              );
              document
                .getElementById("manualDepositModal")
                .classList.remove("active");
              document.getElementById("manualDepositForm").reset();

              // Reload deposits data
              loadDepositsData();

              // Notify user (in a real app)
              if (notifyUser) {
                showToast(
                  "info",
                  "Notification",
                  "User notified about manual deposit"
                );
              }
            })
            .catch((error) => {
              console.error("Error adding manual deposit:", error);
              showToast("error", "Error", "Failed to add manual deposit");
              hideLoading();
            });
        });

      // Manual withdrawal
      document
        .getElementById("manualWithdrawalBtn")
        .addEventListener("click", () => {
          // Similar to manual deposit, but for withdrawals
          showToast(
            "info",
            "Coming Soon",
            "Manual withdrawal feature coming soon"
          );
        });

      // Manage referral settings
      document
        .getElementById("manageReferralSettingsBtn")
        .addEventListener("click", () => {
          // Scroll to referral settings
          document
            .getElementById("referralBonus")
            .scrollIntoView({ behavior: "smooth" });
          showToast("info", "Info", "Update referral settings below");
        });

      // Manage investment plans
      document
        .getElementById("manageInvestmentPlansBtn")
        .addEventListener("click", () => {
          // Scroll to investment plans section
          document
            .getElementById("plansTable")
            .scrollIntoView({ behavior: "smooth" });
          showToast("info", "Info", "Manage investment plans below");
        });

      // View all activities
      document
        .getElementById("viewAllActivitiesBtn")
        .addEventListener("click", () => {
          // Switch to logs section
          document.querySelector('[data-section="logs"]').click();
        });

      // Initialize the dashboard
      function init() {
        // // Check if admin is logged in
        // if (!sessionStorage.getItem("adminUser")) {
        //   window.location.href = "admin-login.html";
        //   return;
        // }

        // Load dashboard data by default
        loadDashboardData();

        // Set up event listeners for filter changes
        document
          .getElementById("userStatusFilter")
          .addEventListener("change", renderUsersTable);
        document
          .getElementById("userDateFilter")
          .addEventListener("change", renderUsersTable);
        document
          .getElementById("userSearchFilter")
          .addEventListener("input", renderUsersTable);

        document
          .getElementById("depositStatusFilter")
          .addEventListener("change", renderDepositsTable);
        document
          .getElementById("depositDateFilter")
          .addEventListener("change", renderDepositsTable);
        document
          .getElementById("depositSearchFilter")
          .addEventListener("input", renderDepositsTable);

        document
          .getElementById("withdrawalStatusFilter")
          .addEventListener("change", renderWithdrawalsTable);
        document
          .getElementById("withdrawalDateFilter")
          .addEventListener("change", renderWithdrawalsTable);
        document
          .getElementById("withdrawalSearchFilter")
          .addEventListener("input", renderWithdrawalsTable);

        document
          .getElementById("investmentStatusFilter")
          .addEventListener("change", renderInvestmentsTable);
        document
          .getElementById("investmentPlanFilter")
          .addEventListener("change", renderInvestmentsTable);
        document
          .getElementById("investmentSearchFilter")
          .addEventListener("input", renderInvestmentsTable);

        document
          .getElementById("logTypeFilter")
          .addEventListener("change", renderLogsTable);
        document
          .getElementById("logDateFilter")
          .addEventListener("change", renderLogsTable);
        document
          .getElementById("logSearchFilter")
          .addEventListener("input", renderLogsTable);
      }

      // Initialize the dashboard when DOM is loaded
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
